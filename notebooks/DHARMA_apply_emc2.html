
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>&lt;no title&gt; &#8212; NASA-GISS LES-SCM Overview</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script async="async" kind="hypothesis" src="https://hypothes.is/embed.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/DHARMA_apply_emc2';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../README.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/123025312.png" class="logo__image only-light" alt="NASA-GISS LES-SCM Overview - Home"/>
    <script>document.write(`<img src="../_static/123025312.png" class="logo__image only-dark" alt="NASA-GISS LES-SCM Overview - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../README.html">
                    LES-SCM
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Project Information</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="cases_list.html">Overview of Cases</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../case_description.html">Case Descriptions</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="case_descr_20200313.html">2020-03-13</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Simulations</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../obs_constrained_les_scm.html">Observation-constrained LES-SCM</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="case_plotting_20200313.html">2020-03-13</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/NASA-GISS/LES-SCM" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/notebooks/DHARMA_apply_emc2.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1><no title></h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="simple visible nav section-nav flex-column">
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">run</span> functions_emc2_prep.py
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## convert DHARMA output into EMC^2-friendly format</span>
<span class="c1">#dharma_for_emc2(PATH=&#39;/ccsopen/proj/atm133/dharma/Lx25km_dx200m_def_z0_def_zi/&#39;,PLT_times=[&#39;029549&#39;])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## apply EMC^2</span>
<span class="c1">###model_path = &#39;/ccsopen/proj/atm133/dharma/emc2_folder/emc2_prep.nc&#39;</span>
<span class="c1">#model_path = &#39;/ccsopen/proj/atm133/dharma/Lx25km_dx200m_def_z0_def_zi/emc2_prep_029549.nc&#39;</span>
<span class="c1">###model_path = &#39;/ccsopen/proj/atm133/dharma/Lx25km_dx200m_def_z0_def_zi/emc2_prep_004320.nc&#39;</span>
<span class="c1">#dharma_out = emc2.core.model.DHARMA(file_path = model_path,time_dim=&quot;time&quot;,single_pi_class=False)</span>
<span class="c1">#full_ds = dharma_out.ds.copy(deep=True)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## convert a 3D DEPHY-style file into EMC^2-friendly format</span>
<span class="c1">#dephy_file = &#39;/home/tflorian/nobackup/dharma_run/cao_2018/DHARMA_Lx25_dx100_ProgNa_nosub_L76_3D_28h.nc&#39; #emc2_prep_041760.nc&#39;</span>
<span class="n">dephy_file</span> <span class="o">=</span> <span class="s1">&#39;/home/tflorian/nobackup/dharma_run/cao_2018/DHARMA_Lx25_dx100_ProgNa_somesub_3D_29h.nc&#39;</span> <span class="c1">#emc2_prep_041760.nc&#39;</span>
<span class="n">dephy_for_emc2</span><span class="p">(</span><span class="n">FILE_IN</span> <span class="o">=</span> <span class="n">dephy_file</span><span class="p">)</span>

<span class="n">dharma_out</span> <span class="o">=</span> <span class="n">emc2</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">DHARMA</span><span class="p">(</span><span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">dephy_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_dephy.nc&quot;</span><span class="p">,</span><span class="n">time_dim</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">,</span><span class="n">single_pi_class</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">full_ds</span> <span class="o">=</span> <span class="n">dharma_out</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/tflorian/nobackup/dharma_run/cao_2018/DHARMA_Lx25_dx100_ProgNa_somesub_3D_29h.nc
/home/tflorian/nobackup/dharma_run/cao_2018/DHARMA_Lx25_dx100_ProgNa_somesub_3D_29h_dephy.nc
&lt;class &#39;netCDF4._netCDF4.Dataset&#39;&gt;
root group (NETCDF3_64BIT_OFFSET data model, file format NETCDF3):
    title: DHARMA LES results for COMBLE-MIP case: fixed Nd and Ni
    reference: https://github.com/ARM-Development/comble-mip
    authors: Florian Tornow (florian.tornow@nasa.gov) and Ann Fridlind (ann.fridlind@nasa.gov)
    version: 2025-05-19 08:42:37
    format_version: DEPHY-derivative
    script: convert_DHARMA_LES_output_to_dephy_format_3D.ipynb
    startDate: 2020-05-12 13:00:00.0
    force_geo: 1
    surfaceType: ocean (after spin-up)
    surfaceForcing: ts (after spin-up)
    dimensions(sizes): x(128), y(128), height(159), time(1)
    variables(dimensions): float64 x(x), float64 y(y), float64 height(height), float64 time(time), float64 pa(time, height), float64 ua(time, height, x, y), float64 va(time, height, x, y), float64 wa(time, height, x, y), float64 ta(time, height, x, y), float64 rhoa(time, height, x, y), float64 qv(time, height, x, y), float64 qlc(time, height, x, y), float64 qlr(time, height, x, y), float64 qic(time, height, x, y), float64 qis(time, height, x, y), float64 qig(time, height, x, y), float64 nlc(time, height, x, y), float64 nlr(time, height, x, y), float64 nic(time, height, x, y), float64 nis(time, height, x, y), float64 nig(time, height, x, y), float64 eps(time, height, x, y), float64 tend_cond(time, height, x, y), float64 tend_dep(time, height, x, y), float64 tend_rim(time, height, x, y)
    groups: 
&lt;class &#39;netCDF4._netCDF4.Dataset&#39;&gt;
root group (NETCDF4_CLASSIC data model, file format HDF5):
    dimensions(sizes): 
    variables(dimensions): 
    groups: 
Dataset is closed!
/home/tflorian/nobackup/dharma_run/cao_2018/DHARMA_Lx25_dx100_ProgNa_somesub_3D_29h_dephy.nc is a regional output dataset; Stacking the time, lat, and lon dims for processing with EMC^2.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">full_ds</span><span class="o">.</span><span class="n">qpi</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
html[data-theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 0 20px 0 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: inline-block;
  opacity: 0;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:focus + label {
  border: 2px solid var(--xr-font-color0);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray &#x27;qpi&#x27; ()&gt; Size: 8B
array(0.00138255)</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'>'qpi'</div></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-716ae3ff-09d6-4053-88a1-f79d743d12bb' class='xr-array-in' type='checkbox' checked><label for='section-716ae3ff-09d6-4053-88a1-f79d743d12bb' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>0.001383</span></div><div class='xr-array-data'><pre>array(0.00138255)</pre></div></div></li><li class='xr-section-item'><input id='section-1c77d8e7-bd48-45e0-8bbd-dcf6e369f969' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-1c77d8e7-bd48-45e0-8bbd-dcf6e369f969' class='xr-section-summary'  title='Expand/collapse section'>Coordinates: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'></ul></div></li><li class='xr-section-item'><input id='section-d43c50cc-30d4-42a5-a925-6c98dc2fe3eb' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-d43c50cc-30d4-42a5-a925-6c98dc2fe3eb' class='xr-section-summary'  title='Expand/collapse section'>Indexes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'></ul></div></li><li class='xr-section-item'><input id='section-6adf43f9-6275-407f-928a-312ce24508c5' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-6adf43f9-6275-407f-928a-312ce24508c5' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## ensure we extract an appropriate number of grid cells</span>

<span class="n">t_target</span> <span class="o">=</span> <span class="mf">1.05</span> <span class="c1"># hour</span>
<span class="c1">#windspeed = 12.25 # m/s - extracted from radiosonde values below 500 m</span>
<span class="n">windspeed</span> <span class="o">=</span> <span class="mf">10.0</span> <span class="c1"># m/s - extracted from radiosonde values below 500 m</span>
<span class="n">horiz_res</span> <span class="o">=</span> <span class="mi">200</span> <span class="c1"># m - needs to be adapted as simulations are swapped</span>

<span class="c1">## cells if angle was zero </span>
<span class="n">num_cells</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">windspeed</span><span class="o">*</span><span class="n">t_target</span><span class="o">*</span><span class="mi">3600</span><span class="o">/</span><span class="n">horiz_res</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_cells</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>189
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">KAZR_dharma</span> <span class="o">=</span> <span class="n">emc2</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">instruments</span><span class="o">.</span><span class="n">KAZR</span><span class="p">(</span><span class="s1">&#39;awr&#39;</span><span class="p">)</span>
<span class="n">MPL_dharma</span> <span class="o">=</span> <span class="n">emc2</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">instruments</span><span class="o">.</span><span class="n">HSRL</span><span class="p">()</span>
<span class="n">CALIOP_dharma</span> <span class="o">=</span> <span class="n">emc2</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">instruments</span><span class="o">.</span><span class="n">CALIOP</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## determine average u and v wind components in lowest X m</span>
<span class="n">max_hgt</span> <span class="o">=</span> <span class="mf">1000.</span>
<span class="n">wind_sub</span> <span class="o">=</span> <span class="n">full_ds</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">hgt</span><span class="o">=</span><span class="n">full_ds</span><span class="p">[</span><span class="s1">&#39;hgt&#39;</span><span class="p">][</span><span class="n">full_ds</span><span class="p">[</span><span class="s1">&#39;hgt&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="n">max_hgt</span><span class="p">])[(</span><span class="s1">&#39;u_wind&#39;</span><span class="p">)]</span>
<span class="n">u_ave</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">wind_sub</span><span class="p">)</span>
<span class="n">wind_sub</span> <span class="o">=</span> <span class="n">full_ds</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">hgt</span><span class="o">=</span><span class="n">full_ds</span><span class="p">[</span><span class="s1">&#39;hgt&#39;</span><span class="p">][</span><span class="n">full_ds</span><span class="p">[</span><span class="s1">&#39;hgt&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="n">max_hgt</span><span class="p">])[(</span><span class="s1">&#39;v_wind&#39;</span><span class="p">)]</span>
<span class="n">v_ave</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">wind_sub</span><span class="p">)</span>

<span class="n">ew_dist</span> <span class="o">=</span> <span class="n">u_ave</span>
<span class="n">ns_dist</span> <span class="o">=</span> <span class="n">v_ave</span>
<span class="n">ve_dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ew_dist</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">ns_dist</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">b_ang</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ew_dist</span><span class="o">/</span><span class="n">ns_dist</span><span class="p">))</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Before&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">b_ang</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="k">if</span> <span class="n">ns_dist</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">ew_dist</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">b</span> <span class="o">=</span> <span class="o">+</span><span class="n">b_ang</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">b</span> <span class="o">=</span> <span class="o">-</span><span class="n">b_ang</span>
<span class="k">else</span><span class="p">:</span>    
    <span class="k">if</span> <span class="n">ew_dist</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">b</span> <span class="o">=</span> <span class="o">-</span><span class="n">b_ang</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">b_ang</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Angle&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>    

<span class="c1">## find indices for specific x (works but slow!)</span>
<span class="c1">#print(full_ds.copy(deep=True).isel({&quot;time_lat_lon&quot;: [1]}))</span>
<span class="c1">#tll_vec = np.array([])</span>
<span class="c1">#for tll in range(len(full_ds[&#39;time_lat_lon&#39;])):</span>
<span class="c1">#    if(full_ds.copy(deep=True).isel({&quot;time_lat_lon&quot;: [tll]})[&#39;x&#39;].data == -12650.):</span>
<span class="c1">#        tll_vec = np.concatenate((tll_vec,tll),axis=None)</span>
<span class="c1">#        print(tll_vec)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Before
74.46429978848919
Angle
-74.46429978848919
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## for CALIPSO processing assume roughly the angle of intercept</span>
<span class="c1">#b = pd.DataFrame()</span>
<span class="c1">#b.data = 45.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ang_target</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">data</span>
<span class="c1">#ang_target = -73.598</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">angi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">angi</span><span class="p">,(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angi</span><span class="o">/</span><span class="mi">90</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">45</span><span class="o">/</span><span class="mi">180</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">45</span><span class="o">/</span><span class="mi">180</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x14e3165a9700&gt;]
</pre></div>
</div>
<img alt="../_images/c5ac709598e6aa255006e12170720ff718a84131a6f6aadb04e71202720b5d11.png" src="../_images/c5ac709598e6aa255006e12170720ff718a84131a6f6aadb04e71202720b5d11.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## new method to obtain line with displacement</span>

<span class="n">dim_xy</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">full_ds</span><span class="p">[</span><span class="s1">&#39;time_lat_lon&#39;</span><span class="p">])))</span>

<span class="n">x_init</span> <span class="o">=</span> <span class="mf">5500.0</span>
<span class="n">y_init</span> <span class="o">=</span> <span class="n">full_ds</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>

<span class="n">y_target</span> <span class="o">=</span> <span class="o">-</span><span class="mf">9500.0</span> <span class="c1">#y_init</span>
<span class="n">x_target</span> <span class="o">=</span> <span class="mf">12000.0</span> <span class="c1">#x_init</span>
<span class="n">x_target</span> <span class="o">=</span> <span class="mf">5000.0</span> <span class="c1">#x_init</span>
<span class="n">x_target</span> <span class="o">=</span> <span class="mf">2000.0</span> <span class="c1">#x_init</span>
<span class="c1">#x_target = 9000.0 #x_init</span>

<span class="c1">## number of cells when accounting for angle</span>
<span class="n">cor_factor</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ang_target</span><span class="o">/</span><span class="mi">90</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">45</span><span class="o">/</span><span class="mi">180</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">45</span><span class="o">/</span><span class="mi">180</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
<span class="n">num_cells_cor</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cor_factor</span><span class="o">*</span><span class="n">num_cells</span><span class="p">)</span>

<span class="n">tll_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
<span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_cells_cor</span><span class="p">):</span>

    <span class="c1">## identify row </span>
    <span class="n">y_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">full_ds</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">isel</span><span class="p">({</span><span class="s2">&quot;time_lat_lon&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">dim_xy</span><span class="o">*</span><span class="n">dim_xy</span><span class="p">,</span><span class="n">dim_xy</span><span class="p">)})[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_target</span><span class="p">)</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>
    
    <span class="c1">## find values closest</span>
    <span class="n">i_min</span> <span class="o">=</span> <span class="n">y_ind</span><span class="o">*</span><span class="n">dim_xy</span>
    <span class="n">i_max</span> <span class="o">=</span> <span class="n">i_min</span> <span class="o">+</span> <span class="n">dim_xy</span>
    <span class="n">x_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">full_ds</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">isel</span><span class="p">({</span><span class="s2">&quot;time_lat_lon&quot;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="n">i_min</span><span class="p">,</span><span class="n">i_max</span><span class="p">)})[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">-</span> <span class="n">x_target</span><span class="p">)</span>
    <span class="n">tll_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">tll_vec</span><span class="p">,</span><span class="nb">range</span><span class="p">(</span><span class="n">i_min</span><span class="p">,</span><span class="n">i_max</span><span class="p">)[</span><span class="n">x_diff</span><span class="o">.</span><span class="n">argmin</span><span class="p">()]),</span><span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_diff</span><span class="p">)</span>

    <span class="c1">## prepare next step</span>
    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">horiz_res</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">ang_target</span><span class="o">/</span><span class="mi">180</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">horiz_res</span><span class="p">:</span>
        <span class="n">x_target</span> <span class="o">+=</span> <span class="n">horiz_res</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">ang_target</span><span class="o">/</span><span class="mi">180</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="n">y_target</span> <span class="o">+=</span> <span class="n">horiz_res</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x_target</span> <span class="o">+=</span> <span class="n">horiz_res</span>
        <span class="n">y_target</span> <span class="o">+=</span> <span class="n">horiz_res</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">ang_target</span><span class="o">/</span><span class="mi">180</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="n">x_target</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">y_target</span><span class="p">)</span>

    <span class="c1">## action when hitting boundaries</span>
    <span class="k">if</span> <span class="n">y_target</span> <span class="o">&gt;</span> <span class="n">full_ds</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
        <span class="n">y_target</span> <span class="o">=</span> <span class="n">full_ds</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>
        <span class="c1">#x_init += 1000</span>
        <span class="c1">#x_target = x_init </span>
        <span class="c1">#x_target += 1000</span>
    
    <span class="k">if</span> <span class="n">y_target</span> <span class="o">&lt;</span> <span class="n">full_ds</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
        <span class="n">y_target</span> <span class="o">=</span> <span class="n">full_ds</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>
        <span class="c1">#x_init += 1000</span>
        <span class="c1">#x_target = x_init </span>
        <span class="c1">#x_target += 1000</span>
    
    <span class="k">if</span> <span class="n">x_target</span> <span class="o">&lt;</span> <span class="n">full_ds</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
        <span class="n">x_target</span> <span class="o">=</span> <span class="n">full_ds</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">data</span> <span class="o">-</span> <span class="n">horiz_res</span>
        
    <span class="k">if</span> <span class="n">x_target</span> <span class="o">&gt;</span> <span class="n">full_ds</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
        <span class="n">x_target</span> <span class="o">=</span> <span class="n">full_ds</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">data</span> <span class="o">+</span> <span class="n">horiz_res</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2200.0
-9555.599133445592
2400.0
-9611.198266891184
2600.0
-9666.797400336776
2800.0
-9722.396533782368
3000.0
-9777.99566722796
3200.0
-9833.594800673553
3400.0
-9889.193934119145
3600.0
-9944.793067564737
3800.0
-10000.392201010329
4000.0
-10055.99133445592
4200.0
-10111.590467901513
4400.0
-10167.189601347105
4600.0
-10222.788734792697
4800.0
-10278.38786823829
5000.0
-10333.987001683881
5200.0
-10389.586135129473
5400.0
-10445.185268575065
5600.0
-10500.784402020658
5800.0
-10556.38353546625
6000.0
-10611.982668911842
6200.0
-10667.581802357434
6400.0
-10723.180935803026
6600.0
-10778.780069248618
6800.0
-10834.37920269421
7000.0
-10889.978336139802
7200.0
-10945.577469585394
7400.0
-11001.176603030986
7600.0
-11056.775736476578
7800.0
-11112.37486992217
8000.0
-11167.974003367763
8200.0
-11223.573136813355
8400.0
-11279.172270258947
8600.0
-11334.771403704539
8800.0
-11390.370537150131
9000.0
-11445.969670595723
9200.0
-11501.568804041315
9400.0
-11557.167937486907
9600.0
-11612.7670709325
9800.0
-11668.366204378091
10000.0
-11723.965337823684
10200.0
-11779.564471269276
10400.0
-11835.163604714868
10600.0
-11890.76273816046
10800.0
-11946.361871606052
11000.0
-12001.961005051644
11200.0
-12057.560138497236
11400.0
-12113.159271942828
11600.0
-12168.75840538842
11800.0
-12224.357538834012
12000.0
-12279.956672279604
12200.0
-12335.555805725196
12400.0
-12391.154939170789
12600.0
-12446.75407261638
12800.0
-12502.353206061973
-12400.0
-12557.952339507565
-12200.0
-12613.551472953157
-12000.0
-12669.150606398749
-11800.0
-12724.749739844341
-11600.0
-12780.348873289933
-11400.0
-12835.948006735525
-11200.0
12544.400866554408
-11000.0
12488.801733108816
-10800.0
12433.202599663224
-10600.0
12377.603466217632
-10400.0
12322.00433277204
-10200.0
12266.405199326447
-10000.0
12210.806065880855
-9800.0
12155.206932435263
-9600.0
12099.607798989671
-9400.0
12044.00866554408
-9200.0
11988.409532098487
-9000.0
11932.810398652895
-8800.0
11877.211265207303
-8600.0
11821.61213176171
-8400.0
11766.012998316119
-8200.0
11710.413864870527
-8000.0
11654.814731424935
-7800.0
11599.215597979342
-7600.0
11543.61646453375
-7400.0
11488.017331088158
-7200.0
11432.418197642566
-7000.0
11376.819064196974
-6800.0
11321.219930751382
-6600.0
11265.62079730579
-6400.0
11210.021663860198
-6200.0
11154.422530414606
-6000.0
11098.823396969014
-5800.0
11043.224263523422
-5600.0
10987.62513007783
-5400.0
10932.025996632237
-5200.0
10876.426863186645
-5000.0
10820.827729741053
-4800.0
10765.228596295461
-4600.0
10709.629462849869
-4400.0
10654.030329404277
-4200.0
10598.431195958685
-4000.0
10542.832062513093
-3800.0
10487.2329290675
-3600.0
10431.633795621909
-3400.0
10376.034662176316
-3200.0
10320.435528730724
-3000.0
10264.836395285132
-2800.0
10209.23726183954
-2600.0
10153.638128393948
-2400.0
10098.038994948356
-2200.0
10042.439861502764
-2000.0
9986.840728057172
-1800.0
9931.24159461158
-1600.0
9875.642461165988
-1400.0
9820.043327720396
-1200.0
9764.444194274804
-1000.0
9708.845060829211
-800.0
9653.24592738362
-600.0
9597.646793938027
-400.0
9542.047660492435
-200.0
9486.448527046843
0.0
9430.849393601251
200.0
9375.250260155659
400.0
9319.651126710067
600.0
9264.051993264475
800.0
9208.452859818883
1000.0
9152.85372637329
1200.0
9097.254592927698
1400.0
9041.655459482106
1600.0
8986.056326036514
1800.0
8930.457192590922
2000.0
8874.85805914533
2200.0
8819.258925699738
2400.0
8763.659792254146
2600.0
8708.060658808554
2800.0
8652.461525362962
3000.0
8596.86239191737
3200.0
8541.263258471778
3400.0
8485.664125026186
3600.0
8430.064991580593
3800.0
8374.465858135001
4000.0
8318.86672468941
4200.0
8263.267591243817
4400.0
8207.668457798225
4600.0
8152.069324352633
4800.0
8096.470190907041
5000.0
8040.871057461449
5200.0
7985.271924015857
5400.0
7929.672790570265
5600.0
7874.0736571246725
5800.0
7818.47452367908
6000.0
7762.875390233488
6200.0
7707.276256787896
6400.0
7651.677123342304
6600.0
7596.077989896712
6800.0
7540.47885645112
7000.0
7484.879723005528
7200.0
7429.280589559936
7400.0
7373.681456114344
7600.0
7318.082322668752
7800.0
7262.48318922316
8000.0
7206.8840557775675
8200.0
7151.284922331975
8400.0
7095.685788886383
8600.0
7040.086655440791
8800.0
6984.487521995199
9000.0
6928.888388549607
9200.0
6873.289255104015
9400.0
6817.690121658423
9600.0
6762.090988212831
9800.0
6706.491854767239
10000.0
6650.892721321647
10200.0
6595.2935878760545
10400.0
6539.694454430462
10600.0
6484.09532098487
10800.0
6428.496187539278
11000.0
6372.897054093686
11200.0
6317.297920648094
11400.0
6261.698787202502
</pre></div>
</div>
<img alt="../_images/42c5d133c51952af8d60de8043a1e7b8fd6c47f244b6777d092faa63c7eab6ef.png" src="../_images/42c5d133c51952af8d60de8043a1e7b8fd6c47f244b6777d092faa63c7eab6ef.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dharma_out</span><span class="o">.</span><span class="n">ds</span> <span class="o">=</span> <span class="n">full_ds</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">isel</span><span class="p">({</span><span class="s2">&quot;time_lat_lon&quot;</span><span class="p">:</span> <span class="n">tll_vec</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)})</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dharma_out</span><span class="o">.</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span><span class="n">dharma_out</span><span class="o">.</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">full_ds</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">full_ds</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">full_ds</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">full_ds</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(-12800.0, 12600.0)
</pre></div>
</div>
<img alt="../_images/001210d4e58dd5edaf5271be4f15bff727eef2c677ab174d566c41e5957f7b0b.png" src="../_images/001210d4e58dd5edaf5271be4f15bff727eef2c677ab174d566c41e5957f7b0b.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## subset points along line</span>
<span class="n">dharma_out</span><span class="o">.</span><span class="n">ds</span> <span class="o">=</span> <span class="n">full_ds</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">isel</span><span class="p">({</span><span class="s2">&quot;time_lat_lon&quot;</span><span class="p">:</span> <span class="n">tll_vec</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)})</span>

<span class="c1">## produce statistic</span>
<span class="n">dharma_stat</span> <span class="o">=</span> <span class="n">full_ds</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">hgt</span><span class="o">=</span><span class="n">full_ds</span><span class="p">[</span><span class="s1">&#39;hgt&#39;</span><span class="p">][</span><span class="n">full_ds</span><span class="p">[</span><span class="s1">&#39;hgt&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">5000</span><span class="p">])</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;hgt&#39;</span><span class="p">])</span>
<span class="c1">#print(dharma_stat)</span>
<span class="n">dharma_stat</span><span class="p">[</span><span class="s1">&#39;all_cond&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dharma_stat</span><span class="p">[</span><span class="s1">&#39;qcl&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dharma_stat</span><span class="p">[</span><span class="s1">&#39;qpl&#39;</span><span class="p">]</span><span class="o">+</span> <span class="n">dharma_stat</span><span class="p">[</span><span class="s1">&#39;qci&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dharma_stat</span><span class="p">[</span><span class="s1">&#39;qpi&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dharma_stat</span><span class="p">[</span><span class="s1">&#39;qci&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dharma_stat</span><span class="p">[</span><span class="s1">&#39;qpir&#39;</span><span class="p">])</span><span class="o">/</span><span class="n">dharma_stat</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span><span class="c1"># </span>

<span class="c1">## show selected points</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dharma_out</span><span class="o">.</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span><span class="n">dharma_out</span><span class="o">.</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">dharma_stat</span><span class="p">[</span><span class="s1">&#39;all_cond&#39;</span><span class="p">][:,:,</span><span class="mi">0</span><span class="p">],</span><span class="n">norm</span><span class="o">=</span><span class="n">colors</span><span class="o">.</span><span class="n">LogNorm</span><span class="p">(),</span><span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">full_ds</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">full_ds</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span><span class="n">full_ds</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span><span class="n">full_ds</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()])</span>
<span class="c1">#plt.gca().invert_yaxis()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
<span class="c1">#plt.gca().invert_xaxis()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span>

<span class="c1">#full_ds.sel(hgt=full_ds[&#39;hgt&#39;][full_ds[&#39;hgt&#39;]&lt;1000])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;function matplotlib.pyplot.show(close=None, block=None)&gt;
</pre></div>
</div>
<img alt="../_images/004e15bde808def96024492b751c7f2e662f3eae4c7b29d6bff2706a410a15f8.png" src="../_images/004e15bde808def96024492b751c7f2e662f3eae4c7b29d6bff2706a410a15f8.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## check for missing values etc</span>
<span class="n">full_ds</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s1">&#39;time_lat_lon&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s1">&#39;hgt&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
html[data-theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 0 20px 0 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: inline-block;
  opacity: 0;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:focus + label {
  border: 2px solid var(--xr-font-color0);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt; Size: 2kB
Dimensions:         (y_tmp: 128, x_tmp: 128, time_tmp: 1)
Coordinates:
  * y_tmp           (y_tmp) float64 1kB -1.28e+04 -1.26e+04 ... 1.26e+04
  * x_tmp           (x_tmp) float64 1kB -1.28e+04 -1.26e+04 ... 1.26e+04
  * time_tmp        (time_tmp) int64 8B 0
Data variables: (12/23)
    z               int64 8B 0
    u_wind          int64 8B 0
    v_wind          int64 8B 0
    w_wind          int64 8B 0
    qcl             int64 8B 0
    qci             int64 8B 0
    ...              ...
    strat_cl_frac   int64 8B 0
    strat_ci_frac   int64 8B 0
    strat_pl_frac   int64 8B 0
    strat_pi_frac   int64 8B 0
    strat_pir_frac  int64 8B 0
    conv_dat        int64 8B 0</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-531135d5-bc30-4ba1-9179-40b1de5cf0d3' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-531135d5-bc30-4ba1-9179-40b1de5cf0d3' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>y_tmp</span>: 128</li><li><span class='xr-has-index'>x_tmp</span>: 128</li><li><span class='xr-has-index'>time_tmp</span>: 1</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-1d7e5883-e473-491c-96b4-e1a8e69bb3a8' class='xr-section-summary-in' type='checkbox'  checked><label for='section-1d7e5883-e473-491c-96b4-e1a8e69bb3a8' class='xr-section-summary' >Coordinates: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>y_tmp</span></div><div class='xr-var-dims'>(y_tmp)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>-1.28e+04 -1.26e+04 ... 1.26e+04</div><input id='attrs-ae7afc40-44fe-4dcd-94ee-3caa8bcc7632' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-ae7afc40-44fe-4dcd-94ee-3caa8bcc7632' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-5ac05eed-2507-4dbf-bbd5-0608b808ed7b' class='xr-var-data-in' type='checkbox'><label for='data-5ac05eed-2507-4dbf-bbd5-0608b808ed7b' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([-12800., -12600., -12400., -12200., -12000., -11800., -11600., -11400.,
       -11200., -11000., -10800., -10600., -10400., -10200., -10000.,  -9800.,
        -9600.,  -9400.,  -9200.,  -9000.,  -8800.,  -8600.,  -8400.,  -8200.,
        -8000.,  -7800.,  -7600.,  -7400.,  -7200.,  -7000.,  -6800.,  -6600.,
        -6400.,  -6200.,  -6000.,  -5800.,  -5600.,  -5400.,  -5200.,  -5000.,
        -4800.,  -4600.,  -4400.,  -4200.,  -4000.,  -3800.,  -3600.,  -3400.,
        -3200.,  -3000.,  -2800.,  -2600.,  -2400.,  -2200.,  -2000.,  -1800.,
        -1600.,  -1400.,  -1200.,  -1000.,   -800.,   -600.,   -400.,   -200.,
            0.,    200.,    400.,    600.,    800.,   1000.,   1200.,   1400.,
         1600.,   1800.,   2000.,   2200.,   2400.,   2600.,   2800.,   3000.,
         3200.,   3400.,   3600.,   3800.,   4000.,   4200.,   4400.,   4600.,
         4800.,   5000.,   5200.,   5400.,   5600.,   5800.,   6000.,   6200.,
         6400.,   6600.,   6800.,   7000.,   7200.,   7400.,   7600.,   7800.,
         8000.,   8200.,   8400.,   8600.,   8800.,   9000.,   9200.,   9400.,
         9600.,   9800.,  10000.,  10200.,  10400.,  10600.,  10800.,  11000.,
        11200.,  11400.,  11600.,  11800.,  12000.,  12200.,  12400.,  12600.])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>x_tmp</span></div><div class='xr-var-dims'>(x_tmp)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>-1.28e+04 -1.26e+04 ... 1.26e+04</div><input id='attrs-1428d550-c3e6-4ae3-bd6c-54318926770d' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-1428d550-c3e6-4ae3-bd6c-54318926770d' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-eada3fa6-dfb9-42ed-b96f-8c74b5dffc6f' class='xr-var-data-in' type='checkbox'><label for='data-eada3fa6-dfb9-42ed-b96f-8c74b5dffc6f' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([-12800., -12600., -12400., -12200., -12000., -11800., -11600., -11400.,
       -11200., -11000., -10800., -10600., -10400., -10200., -10000.,  -9800.,
        -9600.,  -9400.,  -9200.,  -9000.,  -8800.,  -8600.,  -8400.,  -8200.,
        -8000.,  -7800.,  -7600.,  -7400.,  -7200.,  -7000.,  -6800.,  -6600.,
        -6400.,  -6200.,  -6000.,  -5800.,  -5600.,  -5400.,  -5200.,  -5000.,
        -4800.,  -4600.,  -4400.,  -4200.,  -4000.,  -3800.,  -3600.,  -3400.,
        -3200.,  -3000.,  -2800.,  -2600.,  -2400.,  -2200.,  -2000.,  -1800.,
        -1600.,  -1400.,  -1200.,  -1000.,   -800.,   -600.,   -400.,   -200.,
            0.,    200.,    400.,    600.,    800.,   1000.,   1200.,   1400.,
         1600.,   1800.,   2000.,   2200.,   2400.,   2600.,   2800.,   3000.,
         3200.,   3400.,   3600.,   3800.,   4000.,   4200.,   4400.,   4600.,
         4800.,   5000.,   5200.,   5400.,   5600.,   5800.,   6000.,   6200.,
         6400.,   6600.,   6800.,   7000.,   7200.,   7400.,   7600.,   7800.,
         8000.,   8200.,   8400.,   8600.,   8800.,   9000.,   9200.,   9400.,
         9600.,   9800.,  10000.,  10200.,  10400.,  10600.,  10800.,  11000.,
        11200.,  11400.,  11600.,  11800.,  12000.,  12200.,  12400.,  12600.])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time_tmp</span></div><div class='xr-var-dims'>(time_tmp)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0</div><input id='attrs-320db39c-1a42-4cc7-8d2e-599911bd425b' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-320db39c-1a42-4cc7-8d2e-599911bd425b' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-df9a1038-58f4-45a4-b4d4-18bb5485a32d' class='xr-var-data-in' type='checkbox'><label for='data-df9a1038-58f4-45a4-b4d4-18bb5485a32d' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([0])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-61f608b0-8fb3-48c8-8077-cc6ed8382ef2' class='xr-section-summary-in' type='checkbox'  ><label for='section-61f608b0-8fb3-48c8-8077-cc6ed8382ef2' class='xr-section-summary' >Data variables: <span>(23)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>z</span></div><div class='xr-var-dims'>()</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0</div><input id='attrs-a92f5e2c-7016-4da6-8f88-b203cdebc6b3' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-a92f5e2c-7016-4da6-8f88-b203cdebc6b3' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-56a25e47-9ff4-4f4f-bef8-fdce1001498a' class='xr-var-data-in' type='checkbox'><label for='data-56a25e47-9ff4-4f4f-bef8-fdce1001498a' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array(0)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>u_wind</span></div><div class='xr-var-dims'>()</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0</div><input id='attrs-d18cf27e-39e1-4e87-9d8e-53d0adb42322' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-d18cf27e-39e1-4e87-9d8e-53d0adb42322' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-185280e3-a82d-4fbf-a6aa-eda9d1ac763d' class='xr-var-data-in' type='checkbox'><label for='data-185280e3-a82d-4fbf-a6aa-eda9d1ac763d' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array(0)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>v_wind</span></div><div class='xr-var-dims'>()</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0</div><input id='attrs-134239db-252e-4fbb-93cb-c1a9d8e7f6f3' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-134239db-252e-4fbb-93cb-c1a9d8e7f6f3' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-5bf1e15f-4a9b-42ee-b2b8-d071ceb1904b' class='xr-var-data-in' type='checkbox'><label for='data-5bf1e15f-4a9b-42ee-b2b8-d071ceb1904b' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array(0)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>w_wind</span></div><div class='xr-var-dims'>()</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0</div><input id='attrs-da20c784-4fa7-4f88-9d69-466a007ddc23' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-da20c784-4fa7-4f88-9d69-466a007ddc23' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-e40f2d89-6bd8-404b-8d78-87da563cc8fc' class='xr-var-data-in' type='checkbox'><label for='data-e40f2d89-6bd8-404b-8d78-87da563cc8fc' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array(0)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>qcl</span></div><div class='xr-var-dims'>()</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0</div><input id='attrs-3bd41989-33b1-48d7-af9f-644d8ef60a99' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-3bd41989-33b1-48d7-af9f-644d8ef60a99' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-db5066da-ea97-4493-9eda-8a9087732f71' class='xr-var-data-in' type='checkbox'><label for='data-db5066da-ea97-4493-9eda-8a9087732f71' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array(0)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>qci</span></div><div class='xr-var-dims'>()</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0</div><input id='attrs-e80826b8-88ab-4d18-9099-36f7fa2571bb' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-e80826b8-88ab-4d18-9099-36f7fa2571bb' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-749c28e6-8162-43bf-9f1e-1417b0ee52d1' class='xr-var-data-in' type='checkbox'><label for='data-749c28e6-8162-43bf-9f1e-1417b0ee52d1' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array(0)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>qpl</span></div><div class='xr-var-dims'>()</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0</div><input id='attrs-0356eb2d-8a20-44c2-8775-7a49ef6ca141' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-0356eb2d-8a20-44c2-8775-7a49ef6ca141' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-85fb40d6-6d1a-443d-a225-6cfafedb5f42' class='xr-var-data-in' type='checkbox'><label for='data-85fb40d6-6d1a-443d-a225-6cfafedb5f42' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array(0)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>qpi</span></div><div class='xr-var-dims'>()</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0</div><input id='attrs-f71fa803-536d-430c-bf68-cc3ffe66c3c6' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-f71fa803-536d-430c-bf68-cc3ffe66c3c6' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-3a67d678-21a2-441b-aa57-464f10598298' class='xr-var-data-in' type='checkbox'><label for='data-3a67d678-21a2-441b-aa57-464f10598298' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array(0)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>qpir</span></div><div class='xr-var-dims'>()</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0</div><input id='attrs-7ad53e36-fbb4-4a2b-972f-5095cbad90da' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-7ad53e36-fbb4-4a2b-972f-5095cbad90da' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-4cf53850-d364-4729-b0db-14bbb8938696' class='xr-var-data-in' type='checkbox'><label for='data-4cf53850-d364-4729-b0db-14bbb8938696' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array(0)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>ncl</span></div><div class='xr-var-dims'>()</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0</div><input id='attrs-0e813ddf-7ea4-4e32-b863-a07dc4e3e91c' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-0e813ddf-7ea4-4e32-b863-a07dc4e3e91c' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-3422cc4b-15ed-4c23-a72b-3ba1c443c915' class='xr-var-data-in' type='checkbox'><label for='data-3422cc4b-15ed-4c23-a72b-3ba1c443c915' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array(0)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>nci</span></div><div class='xr-var-dims'>()</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0</div><input id='attrs-9e71ac8d-041a-48af-89c8-d42e40da69c9' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-9e71ac8d-041a-48af-89c8-d42e40da69c9' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-5faee668-947d-4884-a33a-facc7b3eed09' class='xr-var-data-in' type='checkbox'><label for='data-5faee668-947d-4884-a33a-facc7b3eed09' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array(0)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>npl</span></div><div class='xr-var-dims'>()</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0</div><input id='attrs-60f7734f-f43f-427a-a2ae-a53171f55c5a' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-60f7734f-f43f-427a-a2ae-a53171f55c5a' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-288f942f-193b-4529-87eb-f01328fc0c11' class='xr-var-data-in' type='checkbox'><label for='data-288f942f-193b-4529-87eb-f01328fc0c11' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array(0)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>npi</span></div><div class='xr-var-dims'>()</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0</div><input id='attrs-361a67d3-22fc-41eb-99fd-f2a51e0e446a' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-361a67d3-22fc-41eb-99fd-f2a51e0e446a' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-cd3a744c-2b42-4b33-b0a0-ef00756282aa' class='xr-var-data-in' type='checkbox'><label for='data-cd3a744c-2b42-4b33-b0a0-ef00756282aa' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array(0)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>npir</span></div><div class='xr-var-dims'>()</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0</div><input id='attrs-ee831a5c-d85f-4b02-85d3-140937aa5d0d' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-ee831a5c-d85f-4b02-85d3-140937aa5d0d' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-bd84ab6a-f3bc-4dc4-91cb-2d17c4e431f6' class='xr-var-data-in' type='checkbox'><label for='data-bd84ab6a-f3bc-4dc4-91cb-2d17c4e431f6' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array(0)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>q</span></div><div class='xr-var-dims'>()</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0</div><input id='attrs-78365745-379b-4d05-92e7-976aae910574' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-78365745-379b-4d05-92e7-976aae910574' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-367ac44d-0633-4da4-8bf5-1085260eb201' class='xr-var-data-in' type='checkbox'><label for='data-367ac44d-0633-4da4-8bf5-1085260eb201' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array(0)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>p</span></div><div class='xr-var-dims'>()</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0</div><input id='attrs-54a495df-93f0-4622-9b13-a7a7d092cc13' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-54a495df-93f0-4622-9b13-a7a7d092cc13' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-18297884-6184-4a76-8132-56f3e0a13d4f' class='xr-var-data-in' type='checkbox'><label for='data-18297884-6184-4a76-8132-56f3e0a13d4f' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array(0)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>t</span></div><div class='xr-var-dims'>()</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0</div><input id='attrs-6a15fb17-0df3-4a18-949b-4f256aa2a7fc' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-6a15fb17-0df3-4a18-949b-4f256aa2a7fc' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-ed917c9a-eb9c-4d06-911f-22c4fb42ae3e' class='xr-var-data-in' type='checkbox'><label for='data-ed917c9a-eb9c-4d06-911f-22c4fb42ae3e' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array(0)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>strat_cl_frac</span></div><div class='xr-var-dims'>()</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0</div><input id='attrs-76091e25-356a-4f81-bcc4-15f46b3099e0' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-76091e25-356a-4f81-bcc4-15f46b3099e0' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-25603e3c-e6f7-431d-a156-eb7c1ccf0fdd' class='xr-var-data-in' type='checkbox'><label for='data-25603e3c-e6f7-431d-a156-eb7c1ccf0fdd' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array(0)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>strat_ci_frac</span></div><div class='xr-var-dims'>()</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0</div><input id='attrs-df9c95a2-2a1b-4ed2-9760-cc4eb27f9799' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-df9c95a2-2a1b-4ed2-9760-cc4eb27f9799' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-0a2f462c-f01a-4aab-9977-87e5dd01ffa9' class='xr-var-data-in' type='checkbox'><label for='data-0a2f462c-f01a-4aab-9977-87e5dd01ffa9' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array(0)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>strat_pl_frac</span></div><div class='xr-var-dims'>()</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0</div><input id='attrs-abb59d50-5a5d-46b3-894a-f726714d5d0d' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-abb59d50-5a5d-46b3-894a-f726714d5d0d' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-c4e1cac8-1d87-43f3-95ef-0d3e2da4eafe' class='xr-var-data-in' type='checkbox'><label for='data-c4e1cac8-1d87-43f3-95ef-0d3e2da4eafe' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array(0)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>strat_pi_frac</span></div><div class='xr-var-dims'>()</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0</div><input id='attrs-ee68a670-bae6-43b0-8d52-727e76c6e9ec' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-ee68a670-bae6-43b0-8d52-727e76c6e9ec' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-93af5085-4275-44e7-8663-680d3d3aaed0' class='xr-var-data-in' type='checkbox'><label for='data-93af5085-4275-44e7-8663-680d3d3aaed0' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array(0)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>strat_pir_frac</span></div><div class='xr-var-dims'>()</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0</div><input id='attrs-4b37d4c2-8fa3-4d62-b23b-04f0bceb07bc' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-4b37d4c2-8fa3-4d62-b23b-04f0bceb07bc' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-d3782eb7-c03b-4a40-97df-e1e31162dfb5' class='xr-var-data-in' type='checkbox'><label for='data-d3782eb7-c03b-4a40-97df-e1e31162dfb5' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array(0)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>conv_dat</span></div><div class='xr-var-dims'>()</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0</div><input id='attrs-e16df9f5-0752-4e05-8113-da84c0f13f8f' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-e16df9f5-0752-4e05-8113-da84c0f13f8f' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-07a8e8c8-3713-403b-8ebf-2936cce689c6' class='xr-var-data-in' type='checkbox'><label for='data-07a8e8c8-3713-403b-8ebf-2936cce689c6' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array(0)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-b06ad94c-3d11-4fb5-9402-08bb07c67a9b' class='xr-section-summary-in' type='checkbox'  ><label for='section-b06ad94c-3d11-4fb5-9402-08bb07c67a9b' class='xr-section-summary' >Indexes: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>y_tmp</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-1d27c537-34aa-4036-9c91-38db1bb79a56' class='xr-index-data-in' type='checkbox'/><label for='index-1d27c537-34aa-4036-9c91-38db1bb79a56' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([-12800.0, -12600.0, -12400.0, -12200.0, -12000.0, -11800.0, -11600.0,
       -11400.0, -11200.0, -11000.0,
       ...
        10800.0,  11000.0,  11200.0,  11400.0,  11600.0,  11800.0,  12000.0,
        12200.0,  12400.0,  12600.0],
      dtype=&#x27;float64&#x27;, name=&#x27;y_tmp&#x27;, length=128))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>x_tmp</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-cff960ee-9dc3-48c1-b764-e175dd6f74b6' class='xr-index-data-in' type='checkbox'/><label for='index-cff960ee-9dc3-48c1-b764-e175dd6f74b6' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([-12800.0, -12600.0, -12400.0, -12200.0, -12000.0, -11800.0, -11600.0,
       -11400.0, -11200.0, -11000.0,
       ...
        10800.0,  11000.0,  11200.0,  11400.0,  11600.0,  11800.0,  12000.0,
        12200.0,  12400.0,  12600.0],
      dtype=&#x27;float64&#x27;, name=&#x27;x_tmp&#x27;, length=128))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>time_tmp</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-c7f2a05c-6406-4d1d-ae94-4a6fd1a57d6d' class='xr-index-data-in' type='checkbox'/><label for='index-c7f2a05c-6406-4d1d-ae94-4a6fd1a57d6d' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([0], dtype=&#x27;int64&#x27;, name=&#x27;time_tmp&#x27;))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-12900843-0b49-4fae-9969-b89debdd75ea' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-12900843-0b49-4fae-9969-b89debdd75ea' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">emc2_out_path</span> <span class="o">=</span> <span class="s1">&#39;/ccsopen/proj/atm133/dharma/emc2_folder/dharma_out/&#39;</span>
<span class="n">use_rad_logic</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">mie_for_ice</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">fields_to_grab_td</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;COSP_phase_mask_all_hyd&quot;</span><span class="p">,</span> <span class="s2">&quot;phase_mask_HSRL_all_hyd&quot;</span><span class="p">,</span> <span class="s2">&quot;ext_mask&quot;</span><span class="p">,</span> <span class="s2">&quot;sub_col_beta_att_tot&quot;</span><span class="p">,</span> <span class="s2">&quot;sub_col_OD_tot&quot;</span><span class="p">]</span>

<span class="n">dharma_out</span><span class="o">.</span><span class="n">ds</span> <span class="o">=</span> <span class="n">full_ds</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">isel</span><span class="p">({</span><span class="s2">&quot;time_lat_lon&quot;</span><span class="p">:</span> <span class="n">tll_vec</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)})</span>
<span class="c1">#dharma_out.ds = full_ds.copy(deep=True).isel({&quot;time_lat_lon&quot;: [x+40000 for x in range(0,255,5)]})</span>
<span class="c1">#dharma_out.ds = full_ds.copy(deep=True).isel({&quot;time_lat_lon&quot;: range(0,len(full_ds[&#39;time_lat_lon&#39;])-1,256)}) </span>

<span class="nb">print</span><span class="p">(</span><span class="n">dharma_out</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">qpi</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="c1"># run EMC^2</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;run EMC^2&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;KAZR processing (+ adding vertical motion to V_d&quot;</span><span class="p">)</span>    
<span class="n">dharma_out</span> <span class="o">=</span> <span class="n">emc2</span><span class="o">.</span><span class="n">simulator</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">make_simulated_data</span><span class="p">(</span><span class="n">dharma_out</span><span class="p">,</span> <span class="n">KAZR_dharma</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">do_classify</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">convert_zeros_to_nan</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_rad_logic</span><span class="o">=</span><span class="n">use_rad_logic</span><span class="p">,</span><span class="n">mie_for_ice</span><span class="o">=</span><span class="n">mie_for_ice</span><span class="p">)</span>
<span class="n">dharma_out</span><span class="o">.</span><span class="n">ds</span><span class="p">[</span><span class="s2">&quot;sub_col_Vd_tot&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dharma_out</span><span class="o">.</span><span class="n">ds</span><span class="p">[</span><span class="s2">&quot;sub_col_Vd_tot_strat&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">+</span> <span class="n">dharma_out</span><span class="o">.</span><span class="n">ds</span><span class="p">[</span><span class="s2">&quot;w_wind&quot;</span><span class="p">]</span>
<span class="n">dharma_out</span><span class="o">.</span><span class="n">ds</span><span class="p">[</span><span class="s2">&quot;sub_col_sigma_d_tot&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dharma_out</span><span class="o">.</span><span class="n">ds</span><span class="p">[</span><span class="s2">&quot;sub_col_sigma_d_tot_strat&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MPL processing &quot;</span><span class="p">)</span>    
<span class="n">dharma_out</span> <span class="o">=</span> <span class="n">emc2</span><span class="o">.</span><span class="n">simulator</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">make_simulated_data</span><span class="p">(</span><span class="n">dharma_out</span><span class="p">,</span> <span class="n">MPL_dharma</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">do_classify</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">convert_zeros_to_nan</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_rad_logic</span><span class="o">=</span><span class="n">use_rad_logic</span><span class="p">,</span><span class="n">mie_for_ice</span><span class="o">=</span><span class="n">mie_for_ice</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">dharma_out</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">qpi</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="c1">#print(&quot;CALIOP processing (+ grabbing topdown fields prior to MPL processing&quot;)</span>
<span class="c1">#dharma_out = emc2.simulator.main.make_simulated_data(dharma_out, CALIOP_dharma, 1, do_classify=True, convert_zeros_to_nan=True,</span>
<span class="c1">#                                                         use_rad_logic=use_rad_logic, skip_subcol_gen=True, mie_for_ice=mie_for_ice)</span>

<span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields_to_grab_td</span><span class="p">:</span>
    <span class="n">dharma_out</span><span class="o">.</span><span class="n">ds</span><span class="p">[</span><span class="n">field</span> <span class="o">+</span> <span class="s2">&quot;_topdown&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dharma_out</span><span class="o">.</span><span class="n">ds</span><span class="p">[</span><span class="n">field</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="c1">#print(&quot;MPL processing&quot;)</span>
    <span class="c1">#dharma_out = emc2.simulator.main.make_simulated_data(dharma_out, MPL_dharma, 1, do_classify=True, convert_zeros_to_nan=True,</span>
    <span class="c1">#                                                         use_rad_logic=use_rad_logic, skip_subcol_gen=True, mie_for_ice=mie_for_ice)</span>

<span class="n">tmp_ds</span> <span class="o">=</span> <span class="n">dharma_out</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;xarray.DataArray &#39;qpi&#39; ()&gt; Size: 8B
array(0.00098348)
run EMC^2
KAZR processing (+ adding vertical motion to V_d
## Creating subcolumns...
No convective processing for DHARMA
num_subcolumns == 1 (subcolumn generator turned off); setting subcolumns frac fields to 1 for startiform cl and ci based on q &gt; 0. kg/kg
Done! total processing time = 0.00s
num_subcolumns == 1 (subcolumn generator turned off); setting subcolumns frac fields to 1 for strat precip based on q &gt; 0. kg/kg
Done! total processing time = 0.00s
num_subcolumns == 1 (subcolumn generator turned off); setting subcolumns q (and N micro logic) fields for cl equal to grid-cell mean
num_subcolumns == 1 (subcolumn generator turned off); setting subcolumns q (and N micro logic) fields for ci equal to grid-cell mean
num_subcolumns == 1 (subcolumn generator turned off); setting subcolumns q (and N micro logic) fields for pl equal to grid-cell mean
num_subcolumns == 1 (subcolumn generator turned off); setting subcolumns q (and N micro logic) fields for pi equal to grid-cell mean
num_subcolumns == 1 (subcolumn generator turned off); setting subcolumns q (and N micro logic) fields for pir equal to grid-cell mean
Generating radar moments...
Generating stratiform radar variables using microphysics logic (slowest processing)
Calculating moments for hydrometeor cl
Doing parallel radar calculations for cl
Processing column 150/174
Processing column 0/174
Processing column 100/174
Processing column 50/174
Calculating moments for hydrometeor ci
Doing parallel radar calculation for ci
Processing column 100/174
Processing column 0/174
Calculating moments for hydrometeor pl
Doing parallel radar calculation for pl
Processing column 100/174
Processing column 0/174
Calculating moments for hydrometeor pi
Doing parallel radar calculation for pi
Processing column 100/174
Processing column 0/174
Calculating moments for hydrometeor pir
Doing parallel radar calculation for pir
Processing column 100/174
Processing column 0/174
Now calculating total spectral width (this may take some time)
Stratiform moment for class cl progress: 0/174
Stratiform moment for class cl progress: 150/174
Stratiform moment for class cl progress: 100/174
Stratiform moment for class cl progress: 50/174
Stratiform moment for class progress: 0/174
Stratiform moment for class progress: 150/174
Stratiform moment for class progress: 100/174
Stratiform moment for class progress: 50/174
Stratiform moment for class progress: 100/174
Stratiform moment for class progress: 0/174
Stratiform moment for class progress: 150/174
Stratiform moment for class progress: 50/174
Stratiform moment for class progress: 0/174
Stratiform moment for class progress: 150/174
Stratiform moment for class progress: 100/174
Stratiform moment for class progress: 50/174
Stratiform moment for class progress: 0/174
Stratiform moment for class progress: 100/174
Stratiform moment for class progress: 50/174
Stratiform moment for class progress: 150/174
Done! total processing time = 64.71s
MPL processing 
## Creating subcolumns...
No convective processing for DHARMA
num_subcolumns == 1 (subcolumn generator turned off); setting subcolumns frac fields to 1 for startiform cl and ci based on q &gt; 0. kg/kg
Done! total processing time = 0.00s
num_subcolumns == 1 (subcolumn generator turned off); setting subcolumns frac fields to 1 for strat precip based on q &gt; 0. kg/kg
Done! total processing time = 0.00s
num_subcolumns == 1 (subcolumn generator turned off); setting subcolumns q (and N micro logic) fields for cl equal to grid-cell mean
num_subcolumns == 1 (subcolumn generator turned off); setting subcolumns q (and N micro logic) fields for ci equal to grid-cell mean
num_subcolumns == 1 (subcolumn generator turned off); setting subcolumns q (and N micro logic) fields for pl equal to grid-cell mean
num_subcolumns == 1 (subcolumn generator turned off); setting subcolumns q (and N micro logic) fields for pi equal to grid-cell mean
num_subcolumns == 1 (subcolumn generator turned off); setting subcolumns q (and N micro logic) fields for pir equal to grid-cell mean
Generating lidar moments...
Generating stratiform lidar variables using microphysics logic (slowest processing)
Generating stratiform lidar variables for hydrometeor class cl
Doing parallel lidar calculations for cl
Stratiform moment for class cl progress: 100/174
Stratiform moment for class cl progress: 50/174
Stratiform moment for class cl progress: 0/174
Stratiform moment for class cl progress: 150/174
Generating stratiform lidar variables for hydrometeor class ci
Doing parallel lidar calculations for ci
Stratiform moment for class ci progress: 150/174
Stratiform moment for class ci progress: 0/174
Stratiform moment for class ci progress: 100/174
Stratiform moment for class ci progress: 50/174
Generating stratiform lidar variables for hydrometeor class pl
Doing parallel lidar calculations for pl
Stratiform moment for class pl progress: 50/174
Stratiform moment for class pl progress: 100/174
Stratiform moment for class pl progress: 0/174
Stratiform moment for class pl progress: 150/174
Generating stratiform lidar variables for hydrometeor class pi
Doing parallel lidar calculations for pi
Stratiform moment for class pi progress: 0/174
Stratiform moment for class pi progress: 100/174
Stratiform moment for class pi progress: 50/174
Stratiform moment for class pi progress: 150/174
Generating stratiform lidar variables for hydrometeor class pir
Doing parallel lidar calculations for pir
Stratiform moment for class pir progress: 50/174
Stratiform moment for class pir progress: 100/174
Stratiform moment for class pir progress: 0/174
Stratiform moment for class pir progress: 150/174
Done! total processing time = 33.49s
&lt;xarray.DataArray &#39;qpi&#39; ()&gt; Size: 8B
array(0.00098348)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#cor_factor = (np.cos(ang_target/90*np.pi)**2)*(1 - np.cos(45/180*np.pi)) + np.cos(45/180*np.pi)</span>
<span class="c1">#print(cor_factor)</span>

<span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">horiz_res</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">ang_target</span><span class="o">/</span><span class="mi">180</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">horiz_res</span><span class="p">:</span>
    <span class="n">cor_factor</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">ang_target</span><span class="o">/</span><span class="mi">180</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">cor_factor</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">ang_target</span><span class="o">/</span><span class="mi">180</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">cor_factor</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.float64(0.9634637536076971)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## make up new variable</span>
<span class="c1">#cor_factor = (np.cos(ang_target/90*np.pi)**2)*(1 - np.cos(45/180*np.pi)) + np.cos(45/180*np.pi)</span>
<span class="n">time_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp_ds</span><span class="o">.</span><span class="n">time_lat_lon</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">horiz_res</span><span class="o">/</span><span class="n">cor_factor</span><span class="o">/</span><span class="n">windspeed</span><span class="o">/</span><span class="mi">3600</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## reorganize data to avoid artifacts when working with looped version</span>
<span class="k">for</span> <span class="n">itime</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp_ds</span><span class="o">.</span><span class="n">time_lat_lon</span><span class="p">)):</span>
    <span class="n">tmp_sub</span> <span class="o">=</span> <span class="n">tmp_ds</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time_lat_lon</span> <span class="o">=</span> <span class="n">itime</span><span class="p">)</span><span class="o">.</span><span class="n">drop_vars</span><span class="p">([</span><span class="s1">&#39;time_lat_lon&#39;</span><span class="p">,</span><span class="s1">&#39;x_tmp&#39;</span><span class="p">,</span><span class="s1">&#39;y_tmp&#39;</span><span class="p">])</span>
    <span class="n">tmp_sub</span> <span class="o">=</span> <span class="n">tmp_sub</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="s1">&#39;time_tmp&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">(</span><span class="n">tmp_sub</span><span class="o">.</span><span class="n">time_tmp</span> <span class="o">+</span> <span class="mi">3600</span><span class="o">*</span><span class="n">time_vec</span><span class="p">[</span><span class="n">itime</span><span class="p">])})</span>
    <span class="k">if</span> <span class="n">itime</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">tmp_ds_new</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">tmp_sub</span><span class="p">],</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time_tmp&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">tmp_ds_new</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">tmp_ds_new</span><span class="p">,</span><span class="n">tmp_sub</span><span class="p">],</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time_tmp&#39;</span><span class="p">)</span>
    <span class="c1">#print(tmp_ds_new)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#tmp_ds.sel(subcolumn=0).sel(x_tmp=50.)</span>
<span class="c1">#np.unique(tmp_ds.x_tmp)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">tmp_ds_new</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">subcolumn</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">time_tmp</span><span class="o">*</span><span class="mi">10</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">tmp_ds_new</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">subcolumn</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">hgt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">tmp_ds_new</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">subcolumn</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="s1">&#39;sub_col_Ze_tot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="c1"># norm=colors.LogNorm(), </span>
           <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">,</span><span class="n">extent</span> <span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">()],</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">40</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="c1">#model_display = act.plotting.TimeSeriesDisplay(tmp_ds.sel(subcolumn=0).sel(x_tmp=50.), figsize=(15,5))</span>
<span class="c1">#@model_display.plot(&#39;q&#39;, cmap=&#39;act_HomeyerRainbow&#39;, vmin=-30, vmax=-15)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
<span class="c1">#plt.gca().invert_xaxis()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.colorbar.Colorbar at 0x14e3163cb680&gt;
</pre></div>
</div>
<img alt="../_images/0f240b4c58a6e1f2576434ef8a0109acd3b7bd1b31104f336db0785a07be92c5.png" src="../_images/0f240b4c58a6e1f2576434ef8a0109acd3b7bd1b31104f336db0785a07be92c5.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">mpl_toolkits.axes_grid1</span><span class="w"> </span><span class="kn">import</span> <span class="n">make_axes_locatable</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.colors</span><span class="w"> </span><span class="kn">import</span> <span class="n">LogNorm</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.ticker</span><span class="w"> </span><span class="kn">import</span> <span class="n">MultipleLocator</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">nrows</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_figwidth</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_figheight</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>

<span class="n">H_MAX</span> <span class="o">=</span> <span class="mf">7000.0</span>

<span class="n">im0</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">tmp_ds</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">subcolumn</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">hgt</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="n">H_MAX</span><span class="p">))[</span><span class="s1">&#39;sub_col_Ze_tot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="c1"># norm=colors.LogNorm(), </span>
           <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">,</span><span class="n">extent</span> <span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">H_MAX</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">()],</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">45</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span><span class="n">aspect</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
<span class="c1">#axs[0].invert_xaxis()</span>

<span class="n">divider0</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">cax0</span> <span class="o">=</span> <span class="n">divider0</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;2%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.15</span><span class="p">)</span>
<span class="n">cbar0</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im0</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax0</span><span class="p">)</span>

<span class="n">im1</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">tmp_ds</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">subcolumn</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">hgt</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="n">H_MAX</span><span class="p">))[</span><span class="s1">&#39;sub_col_Vd_tot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="c1"># norm=colors.LogNorm(), </span>
           <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu_r&#39;</span><span class="p">,</span><span class="n">extent</span> <span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">H_MAX</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">()],</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">4</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">aspect</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
<span class="c1">#axs[1].invert_xaxis()</span>

<span class="n">divider1</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">cax1</span> <span class="o">=</span> <span class="n">divider1</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;2%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.15</span><span class="p">)</span>
<span class="n">cbar1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im1</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax1</span><span class="p">)</span>

<span class="n">im2</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">tmp_ds</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">subcolumn</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">hgt</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="n">H_MAX</span><span class="p">))[</span><span class="s1">&#39;sub_col_sigma_d_tot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="c1"># norm=colors.LogNorm(), </span>
           <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span><span class="n">extent</span> <span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">H_MAX</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">()],</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">aspect</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
<span class="c1">#axs[2].invert_xaxis()</span>

<span class="n">divider2</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">cax2</span> <span class="o">=</span> <span class="n">divider2</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;2%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.15</span><span class="p">)</span>
<span class="n">cbar2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im2</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax2</span><span class="p">)</span>

<span class="n">im3</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">tmp_ds</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">subcolumn</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">hgt</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="n">H_MAX</span><span class="p">))[</span><span class="s1">&#39;sub_col_beta_att_tot&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="c1"># norm=colors.LogNorm(), </span>
           <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">,</span><span class="n">extent</span> <span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">H_MAX</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">()],</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">14</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=-</span><span class="mi">9</span><span class="p">,</span><span class="n">aspect</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
<span class="c1">#axs[3].invert_xaxis()</span>

<span class="n">divider3</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
<span class="n">cax3</span> <span class="o">=</span> <span class="n">divider3</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;2%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.15</span><span class="p">)</span>
<span class="n">cbar3</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im3</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax3</span><span class="p">)</span>


<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;EMC$^2$ applied to LES &#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 0.98, &#39;EMC$^2$ applied to LES &#39;)
</pre></div>
</div>
<img alt="../_images/b14e55b1b4775ba0527bff05f1c534ba19eee0b91dde75349c97979281d60a4f.png" src="../_images/b14e55b1b4775ba0527bff05f1c534ba19eee0b91dde75349c97979281d60a4f.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#cor_factor = (np.cos(ang_target/90*np.pi)**2)*(1 - np.cos(45/180*np.pi)) + np.cos(45/180*np.pi)</span>
<span class="c1">## make up new variable</span>
<span class="n">time_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp_ds</span><span class="o">.</span><span class="n">time_lat_lon</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">horiz_res</span><span class="o">/</span><span class="n">cor_factor</span><span class="o">/</span><span class="n">windspeed</span><span class="o">/</span><span class="mi">3600</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## create a new xarray and redefine coordinates</span>

<span class="n">tmp_new_1</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">tmp_ds_new</span><span class="o">.</span><span class="n">sortby</span><span class="p">(</span><span class="s1">&#39;time_tmp&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">subcolumn</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sub_col_Ze_tot</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                       <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;height&#39;</span><span class="p">],</span>
                       <span class="n">coords</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                           <span class="c1">#dist = ([&#39;dist&#39;], tmp_ds.y_tmp.data),</span>
                           <span class="n">time</span> <span class="o">=</span> <span class="p">([</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">time_vec</span><span class="p">),</span>
                           <span class="n">height</span> <span class="o">=</span> <span class="p">([</span><span class="s1">&#39;height&#39;</span><span class="p">],</span><span class="n">tmp_ds</span><span class="o">.</span><span class="n">hgt</span><span class="o">.</span><span class="n">data</span><span class="p">)),</span>
                       <span class="n">attrs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                           <span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;KAZR&#39;</span><span class="p">,</span>
                           <span class="n">long_name</span> <span class="o">=</span> <span class="s1">&#39;$Z_e$&#39;</span><span class="p">,</span>
                           <span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;dBZ&#39;</span><span class="p">))</span>

<span class="n">tmp_new_2</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">tmp_ds</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">subcolumn</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sub_col_Vd_tot</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                       <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;height&#39;</span><span class="p">],</span>
                       <span class="n">coords</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                           <span class="n">time</span> <span class="o">=</span> <span class="p">([</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">time_vec</span><span class="p">),</span>
                           <span class="n">height</span> <span class="o">=</span> <span class="p">([</span><span class="s1">&#39;height&#39;</span><span class="p">],</span><span class="n">tmp_ds</span><span class="o">.</span><span class="n">hgt</span><span class="o">.</span><span class="n">data</span><span class="p">)),</span>
                       <span class="n">attrs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                           <span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;KAZR&#39;</span><span class="p">,</span>
                           <span class="n">long_name</span> <span class="o">=</span> <span class="s1">&#39;$V_D$&#39;</span><span class="p">,</span>
                           <span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;$m s^{-1}$&#39;</span><span class="p">))</span>

<span class="n">tmp_new_3</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">tmp_ds</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">subcolumn</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sub_col_sigma_d_tot</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                       <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;height&#39;</span><span class="p">],</span>
                       <span class="n">coords</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                           <span class="n">time</span> <span class="o">=</span> <span class="p">([</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">time_vec</span><span class="p">),</span>
                           <span class="n">height</span> <span class="o">=</span> <span class="p">([</span><span class="s1">&#39;height&#39;</span><span class="p">],</span><span class="n">tmp_ds</span><span class="o">.</span><span class="n">hgt</span><span class="o">.</span><span class="n">data</span><span class="p">)),</span>
                       <span class="n">attrs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                           <span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;KAZR&#39;</span><span class="p">,</span>
                           <span class="n">long_name</span> <span class="o">=</span> <span class="s1">&#39;$\sigma_D$&#39;</span><span class="p">,</span>
                           <span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;$m s^{-1}$&#39;</span><span class="p">))</span>

<span class="n">tmp_new_4</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">tmp_ds</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">subcolumn</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sub_col_beta_att_tot</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                       <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;height&#39;</span><span class="p">],</span>
                       <span class="n">coords</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                           <span class="n">time</span> <span class="o">=</span> <span class="p">([</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">time_vec</span><span class="p">),</span>
                           <span class="n">height</span> <span class="o">=</span> <span class="p">([</span><span class="s1">&#39;height&#39;</span><span class="p">],</span><span class="n">tmp_ds</span><span class="o">.</span><span class="n">hgt</span><span class="o">.</span><span class="n">data</span><span class="p">)),</span>
                       <span class="n">attrs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                           <span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;MPL&#39;</span><span class="p">,</span>
                           <span class="n">long_name</span> <span class="o">=</span> <span class="s1">&#39;$ </span><span class="se">\\</span><span class="s1">beta_</span><span class="si">{att}</span><span class="s1"> $&#39;</span><span class="p">,</span>
                           <span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;$m^{-1}$ sr$^{-1}$&#39;</span><span class="p">))</span>

<span class="n">tmp_new_1</span> <span class="o">=</span> <span class="n">tmp_new_1</span><span class="o">.</span><span class="n">to_dataset</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;sub_col_Ze_tot&#39;</span><span class="p">)</span>
<span class="n">tmp_new_2</span> <span class="o">=</span> <span class="n">tmp_new_2</span><span class="o">.</span><span class="n">to_dataset</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;sub_col_Vd_tot&#39;</span><span class="p">)</span>
<span class="n">tmp_new_3</span> <span class="o">=</span> <span class="n">tmp_new_3</span><span class="o">.</span><span class="n">to_dataset</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;sub_col_sigma_d_tot&#39;</span><span class="p">)</span>
<span class="n">tmp_new_4</span> <span class="o">=</span> <span class="n">tmp_new_4</span><span class="o">.</span><span class="n">to_dataset</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;sub_col_beta_att_tot&#39;</span><span class="p">)</span>

<span class="n">tmp_new</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">merge</span><span class="p">([</span><span class="n">tmp_new_1</span><span class="p">,</span><span class="n">tmp_new_2</span><span class="p">,</span><span class="n">tmp_new_3</span><span class="p">,</span><span class="n">tmp_new_4</span><span class="p">])</span>
<span class="c1">#tmp_new.sel(height=slice(0,100))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## display fields</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">nrows</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_figwidth</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_figheight</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>

<span class="n">tmp_new</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">7000.0</span><span class="p">))[</span><span class="s1">&#39;sub_col_Ze_tot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;height&#39;</span><span class="p">,</span><span class="n">vmin</span><span class="o">=-</span><span class="mi">45</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">tmp_new</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">7000.0</span><span class="p">))[</span><span class="s1">&#39;sub_col_Vd_tot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;height&#39;</span><span class="p">,</span><span class="n">vmin</span><span class="o">=-</span><span class="mi">4</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu_r&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">tmp_new</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">7000.0</span><span class="p">))[</span><span class="s1">&#39;sub_col_sigma_d_tot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;height&#39;</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">tmp_new</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">7000.0</span><span class="p">))[</span><span class="s1">&#39;sub_col_beta_att_tot&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;height&#39;</span><span class="p">,</span><span class="n">vmin</span><span class="o">=-</span><span class="mi">14</span><span class="p">,</span><span class="n">vmax</span><span class="o">=-</span><span class="mi">9</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
<span class="c1">#np.log(mpl_dat.sel(range_bins=slice(27.25,32.25))[&#39;signal_return_co_pol&#39;]).plot(x=&#39;time&#39;,vmin=-2,vmax=1,cmap=&#39;jet&#39;,ax=axs[3])</span>
<span class="c1">#np.log(mpl_masked.sel(range_bins=slice(27.1,32.1))[&#39;signal_return_cross_pol&#39;]).plot(x=&#39;time&#39;,y=&#39;range&#39;,vmin=-2,vmax=1.5,cmap=&#39;jet&#39;,ax=axs[3])</span>

<span class="c1">## update labels etc</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (h)&#39;</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Height [m]&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Height [m]&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Height [m]&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Height [m]&#39;</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;EMC$^2$ applied to LES             &#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">dephy_file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">dephy_file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">6</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;cao_2018/DHARMA_Lx25_dx100_ProgNa_somesub_3D_29h.nc&#39;)
</pre></div>
</div>
<img alt="../_images/f318d3e015d128c3498ff02d2aa8c6216c4d34e90840c28bf9c9fb4fbb68c0f2.png" src="../_images/f318d3e015d128c3498ff02d2aa8c6216c4d34e90840c28bf9c9fb4fbb68c0f2.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## show CALIPSO equivalent</span>

<span class="n">tmp_ds_sub</span> <span class="o">=</span> <span class="n">tmp_ds</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">tmp_ds</span><span class="o">.</span><span class="n">z</span> <span class="o">&lt;</span> <span class="mi">6000</span><span class="p">,</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">tmp_ds_sub</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">subcolumn</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">x_tmp</span><span class="o">/</span><span class="mi">1000</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">tmp_ds_sub</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">subcolumn</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">hgt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">tmp_ds_sub</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">subcolumn</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="s1">&#39;sub_col_beta_att_tot_topdown&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span><span class="o">*</span><span class="mi">1000</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">colors</span><span class="o">.</span><span class="n">LogNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mf">10e-4</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">10e-1</span><span class="p">),</span> 
           <span class="n">extent</span> <span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">()],</span><span class="n">aspect</span><span class="o">=</span><span class="mi">4</span><span class="o">/</span><span class="mi">1000</span><span class="p">)</span> <span class="c1">#, vmin=10e-3, vmax=10e-1)</span>
<span class="c1">#model_display = act.plotting.TimeSeriesDisplay(tmp_ds.sel(subcolumn=0).sel(x_tmp=50.), figsize=(15,5))</span>
<span class="c1">#@model_display.plot(&#39;q&#39;, cmap=&#39;act_HomeyerRainbow&#39;, vmin=-30, vmax=-15)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">invert_xaxis</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.colorbar.Colorbar at 0x14e316011100&gt;
</pre></div>
</div>
<img alt="../_images/4c268854efcf71584ce36d1e83d6e6e7ef839055c1239e340a77be2996a722f7.png" src="../_images/4c268854efcf71584ce36d1e83d6e6e7ef839055c1239e340a77be2996a722f7.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span><span class="p">(</span><span class="n">full_ds</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="s2">&quot;x_tmp&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">crop_x_quants</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">122</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="nb">int</span><span class="p">(</span><span class="n">full_ds</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="s2">&quot;x_tmp&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">crop_x_quants</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;crop_x_quants&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mf">10e-6</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tll_vec</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">full_ds</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">isel</span><span class="p">({</span><span class="s2">&quot;time_lat_lon&quot;</span><span class="p">:</span> <span class="n">tll_vec</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tmp_ds</span><span class="o">.</span><span class="n">time_lat_lon</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">emc2_out_path</span> <span class="o">=</span> <span class="s1">&#39;/ccsopen/proj/atm133/dharma/emc2_folder/dharma_out/&#39;</span>
<span class="n">use_rad_logic</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">mie_for_ice</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">fields_to_grab_td</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;COSP_phase_mask_all_hyd&quot;</span><span class="p">,</span> <span class="s2">&quot;phase_mask_HSRL_all_hyd&quot;</span><span class="p">,</span> <span class="s2">&quot;ext_mask&quot;</span><span class="p">,</span> <span class="s2">&quot;sub_col_beta_att_tot&quot;</span><span class="p">,</span> <span class="s2">&quot;sub_col_OD_tot&quot;</span><span class="p">]</span>

<span class="n">dharma_out</span><span class="o">.</span><span class="n">ds</span> <span class="o">=</span> <span class="n">full_ds</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">isel</span><span class="p">({</span><span class="s2">&quot;time_lat_lon&quot;</span><span class="p">:</span> <span class="n">tll_vec</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)})</span>

<span class="c1"># run EMC^2</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;run EMC^2&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;KAZR processing (+ adding vertical motion to V_d&quot;</span><span class="p">)</span>    
<span class="n">dharma_out</span> <span class="o">=</span> <span class="n">emc2</span><span class="o">.</span><span class="n">simulator</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">make_simulated_data</span><span class="p">(</span><span class="n">dharma_out</span><span class="p">,</span> <span class="n">KAZR_dharma</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">do_classify</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">convert_zeros_to_nan</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_rad_logic</span><span class="o">=</span><span class="n">use_rad_logic</span><span class="p">,</span><span class="n">mie_for_ice</span><span class="o">=</span><span class="n">mie_for_ice</span><span class="p">)</span>
<span class="n">dharma_out</span><span class="o">.</span><span class="n">ds</span><span class="p">[</span><span class="s2">&quot;sub_col_Vd_tot&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dharma_out</span><span class="o">.</span><span class="n">ds</span><span class="p">[</span><span class="s2">&quot;sub_col_Vd_tot_strat&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">+</span> <span class="n">dharma_out</span><span class="o">.</span><span class="n">ds</span><span class="p">[</span><span class="s2">&quot;w_wind&quot;</span><span class="p">]</span>
<span class="n">dharma_out</span><span class="o">.</span><span class="n">ds</span><span class="p">[</span><span class="s2">&quot;sub_col_sigma_d_tot&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dharma_out</span><span class="o">.</span><span class="n">ds</span><span class="p">[</span><span class="s2">&quot;sub_col_sigma_d_tot_strat&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MPL processing &quot;</span><span class="p">)</span>    
<span class="n">dharma_out</span> <span class="o">=</span> <span class="n">emc2</span><span class="o">.</span><span class="n">simulator</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">make_simulated_data</span><span class="p">(</span><span class="n">dharma_out</span><span class="p">,</span> <span class="n">MPL_dharma</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">do_classify</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">convert_zeros_to_nan</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_rad_logic</span><span class="o">=</span><span class="n">use_rad_logic</span><span class="p">,</span><span class="n">mie_for_ice</span><span class="o">=</span><span class="n">mie_for_ice</span><span class="p">)</span>
    
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tmp_ds</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">subcolumn</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="s1">&#39;hgt&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#print(tmp_ds)</span>

<span class="n">tmp_ds</span> <span class="o">=</span> <span class="n">dharma_out</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1">#tmp_ds.sel(subcolumn=0).sel(x_tmp=50.)</span>
<span class="c1">#np.unique(tmp_ds.x_tmp)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">tmp_ds</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">subcolumn</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="s1">&#39;y_tmp&#39;</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">tmp_ds</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">subcolumn</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="s1">&#39;hgt&#39;</span><span class="p">]</span><span class="c1">#tmp_ds.sel(subcolumn=0).sel(x_tmp=50.).hgt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">tmp_ds</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">subcolumn</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="s1">&#39;sub_col_Ze_tot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="c1"># norm=colors.LogNorm(), </span>
           <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">,</span><span class="n">extent</span> <span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">()],</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">40</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="c1">#model_display = act.plotting.TimeSeriesDisplay(tmp_ds.sel(subcolumn=0).sel(x_tmp=50.), figsize=(15,5))</span>
<span class="c1">#@model_display.plot(&#39;q&#39;, cmap=&#39;act_HomeyerRainbow&#39;, vmin=-30, vmax=-15)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dharma_out</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">qpi</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dephy_file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">dephy_file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">6</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## old code</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pylab</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pl</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">IPython</span><span class="w"> </span><span class="kn">import</span> <span class="n">display</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---fast version of finding along-wind points--&#39;</span><span class="p">)</span>
<span class="n">x0</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1000.</span>
<span class="n">y0</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1000.</span>

<span class="c1">## check each x-val</span>
<span class="n">ang_target</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">data</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ang_target</span><span class="p">)</span>
<span class="n">y_loop</span> <span class="o">=</span> <span class="n">num_cells</span> <span class="c1">#np.int(np.sqrt(len(full_ds[&#39;time_lat_lon&#39;])))</span>
<span class="n">y_len</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">full_ds</span><span class="p">[</span><span class="s1">&#39;time_lat_lon&#39;</span><span class="p">])))</span><span class="o">*</span><span class="mi">2</span>
<span class="n">tll_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
<span class="c1">#full_ds.copy(deep=True).isel({&quot;time_lat_lon&quot;: [1,2,3]})</span>
<span class="n">nudger</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">y_loop</span><span class="p">):</span>
    
    <span class="n">y_use</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">nudger</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">full_ds</span><span class="p">[</span><span class="s1">&#39;time_lat_lon&#39;</span><span class="p">])))</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">y_loop</span><span class="o">*</span><span class="p">(</span><span class="n">y_use</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">full_ds</span><span class="p">[</span><span class="s1">&#39;time_lat_lon&#39;</span><span class="p">]))</span> <span class="o">|</span> <span class="p">(</span><span class="n">y_loop</span><span class="o">*</span><span class="p">(</span><span class="n">y_use</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">full_ds</span><span class="p">[</span><span class="s1">&#39;time_lat_lon&#39;</span><span class="p">])):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;nudge!&#39;</span><span class="p">)</span>
        <span class="c1">#nudger += 1</span>
        <span class="n">x0</span> <span class="o">+=</span> <span class="mf">1000.</span>
        <span class="n">y0</span> <span class="o">+=</span> <span class="mf">1000.</span>
    
    <span class="n">y_use</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">nudger</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">full_ds</span><span class="p">[</span><span class="s1">&#39;time_lat_lon&#39;</span><span class="p">])))</span>
    <span class="n">i_min</span> <span class="o">=</span> <span class="n">y_len</span><span class="o">*</span><span class="p">(</span><span class="n">y_use</span><span class="p">)</span>
    <span class="n">i_max</span> <span class="o">=</span> <span class="n">y_len</span><span class="o">*</span><span class="p">(</span><span class="n">y_use</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i_min</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;____&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i_max</span><span class="p">))</span>
    
    <span class="n">x_vals</span> <span class="o">=</span> <span class="n">full_ds</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">isel</span><span class="p">({</span><span class="s2">&quot;time_lat_lon&quot;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="n">i_min</span><span class="p">,</span><span class="n">i_max</span><span class="p">)})[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> 
    <span class="n">y_vals</span> <span class="o">=</span> <span class="n">full_ds</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">isel</span><span class="p">({</span><span class="s2">&quot;time_lat_lon&quot;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="n">i_min</span><span class="p">,</span><span class="n">i_max</span><span class="p">)})[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="n">ang</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">x_vals</span><span class="o">-</span><span class="n">x0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">y_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">y0</span><span class="p">)))</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="n">ang</span><span class="p">[(</span><span class="n">x_vals</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">y_vals</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)]</span> <span class="o">=</span> <span class="n">ang</span><span class="p">[(</span><span class="n">x_vals</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">y_vals</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)]</span>
    <span class="n">ang</span><span class="p">[(</span><span class="n">x_vals</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">y_vals</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)]</span> <span class="o">=</span> <span class="o">-</span><span class="n">ang</span><span class="p">[(</span><span class="n">x_vals</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">y_vals</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)]</span>
    <span class="n">ang</span><span class="p">[(</span><span class="n">x_vals</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">y_vals</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)]</span> <span class="o">=</span> <span class="o">-</span><span class="n">ang</span><span class="p">[(</span><span class="n">x_vals</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">y_vals</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)]</span>
    <span class="n">ang</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">((</span><span class="n">x_vals</span><span class="o">-</span><span class="n">x0</span><span class="p">),(</span><span class="n">y_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">y0</span><span class="p">))</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="n">ang_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ang</span> <span class="o">-</span> <span class="n">ang_target</span><span class="p">)</span>
    <span class="c1">#print(x_vals[ang_diff.argmin()])</span>
    <span class="c1">#print(range(i_min,i_max)[ang_diff.argmin()])</span>
    <span class="n">tll_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">tll_vec</span><span class="p">,</span><span class="nb">range</span><span class="p">(</span><span class="n">i_min</span><span class="p">,</span><span class="n">i_max</span><span class="p">)[</span><span class="n">ang_diff</span><span class="o">.</span><span class="n">argmin</span><span class="p">()]),</span><span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    
    <span class="n">dharma_out</span><span class="o">.</span><span class="n">ds</span> <span class="o">=</span> <span class="n">full_ds</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">isel</span><span class="p">({</span><span class="s2">&quot;time_lat_lon&quot;</span><span class="p">:</span> <span class="n">tll_vec</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)})</span>    
    <span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dharma_out</span><span class="o">.</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span><span class="n">dharma_out</span><span class="o">.</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
    <span class="c1">#pl.plot(ang_diff)</span>
    <span class="n">display</span><span class="o">.</span><span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">display</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">gcf</span><span class="p">())</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">emc2</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">DHARMA</span>
</pre></div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "act_env"
        },
        kernelOptions: {
            name: "act_env",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'act_env'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="simple visible nav section-nav flex-column">
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By GISS Cloud Group
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>