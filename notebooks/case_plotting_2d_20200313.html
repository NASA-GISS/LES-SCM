
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>2D plotting of LES output vs. satellite imagery (work in progress) &#8212; NASA-GISS LES-SCM Overview</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script async="async" kind="hypothesis" src="https://hypothes.is/embed.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/case_plotting_2d_20200313';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../README.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/123025312.png" class="logo__image only-light" alt="NASA-GISS LES-SCM Overview - Home"/>
    <script>document.write(`<img src="../_static/123025312.png" class="logo__image only-dark" alt="NASA-GISS LES-SCM Overview - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../README.html">
                    LES-SCM
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Project Information</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="cases_list.html">Overview of Cases</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../case_description.html">Case Descriptions</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="case_descr_20200313.html">2020-03-13</a></li>
<li class="toctree-l2"><a class="reference internal" href="case_descr_20200409.html">2020-04-09</a></li>
<li class="toctree-l2"><a class="reference internal" href="case_descr_20200425.html">2020-04-25</a></li>
<li class="toctree-l2"><a class="reference internal" href="case_descr_20200512.html">2020-05-12</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Simulations</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../obs_constrained_les_scm.html">Observation-constrained LES-SCM</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="case_plotting_20200313.html">2020-03-13</a></li>
<li class="toctree-l2"><a class="reference internal" href="case_plotting_20200409.html">2020-04-09</a></li>
<li class="toctree-l2"><a class="reference internal" href="case_plotting_20200425.html">2020-04-25</a></li>
<li class="toctree-l2"><a class="reference internal" href="case_plotting_20200512.html">2020-05-12</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/NASA-GISS/LES-SCM" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/notebooks/case_plotting_2d_20200313.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>

</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>2D plotting of LES output vs. satellite imagery (work in progress)</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="d-plotting-of-les-output-vs-satellite-imagery-work-in-progress">
<h1>2D plotting of LES output vs. satellite imagery (work in progress)<a class="headerlink" href="#d-plotting-of-les-output-vs-satellite-imagery-work-in-progress" title="Link to this heading">#</a></h1>
<ul class="simple">
<li><p>The below notebook compares selected simulations against satellite imagery.</p></li>
<li><p>In case of questions or concerns, please notify <a class="reference internal" href="#emailto:ann.fridlind&#64;nasa.gov"><span class="xref myst">Ann Fridlind</span></a> and <a class="reference internal" href="#emailto:ft2544&#64;columbia.edu"><span class="xref myst">Florian Tornow</span></a>.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mpl</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pyhdf.SD</span><span class="w"> </span><span class="kn">import</span> <span class="n">SD</span><span class="p">,</span> <span class="n">SDC</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy.ma</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ma</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
<span class="c1">#import rioxarray as rxr</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">rasterio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">shapely.geometry</span><span class="w"> </span><span class="kn">import</span> <span class="n">mapping</span><span class="p">,</span> <span class="n">box</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">geopandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gpd</span>
<span class="c1">#import earthpy as et</span>
<span class="c1">#import earthpy.spatial as es</span>
<span class="c1">#import earthpy.plot as ep</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">osgeo</span><span class="w"> </span><span class="kn">import</span> <span class="n">gdal</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="n">xr</span><span class="o">.</span><span class="n">set_options</span><span class="p">(</span><span class="n">display_style</span><span class="o">=</span><span class="s1">&#39;html&#39;</span><span class="p">)</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">glob</span><span class="o">,</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">geopy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">geopy.distance</span>
 
<span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;/gpfsm/dhome/tflorian/LES-SCM/notebooks&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s2">&quot;/gpfsm/dhome/tflorian/LES-SCM/notebooks/&quot;</span><span class="p">)</span>

<span class="o">%</span><span class="k">run</span> functions_plotting.py 
<span class="o">%</span><span class="k">run</span> function_plotting_2d.py 

<span class="c1">## read trajectory</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">nc</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="s1">&#39;../data_files/theta_temp_rh_sh_uvw_sst_along_trajectory_era5ml_28h_end_2020-03-13-18.nc&#39;</span><span class="p">)</span>
<span class="n">les_time</span> <span class="o">=</span> <span class="mf">18.</span> <span class="o">+</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">][:]</span>
    
<span class="c1">## select simulations to plot</span>
<span class="n">sim_keyword</span> <span class="o">=</span> <span class="s1">&#39;_2D&#39;</span>  
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## select times</span>
<span class="n">Time_Vec</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="mf">2.</span><span class="p">,</span><span class="mf">3.</span><span class="p">,</span><span class="mf">4.</span><span class="p">,</span><span class="mf">5.</span><span class="p">,</span><span class="mf">6.</span><span class="p">,</span><span class="mf">7.</span><span class="p">,</span><span class="mf">8.</span><span class="p">,</span><span class="mf">9.</span><span class="p">,</span><span class="mf">10.</span><span class="p">,</span><span class="mf">11.</span><span class="p">,</span><span class="mf">12.</span><span class="p">,</span><span class="mf">13.</span><span class="p">,</span><span class="mf">14.</span><span class="p">,</span><span class="mf">15.</span><span class="p">,</span><span class="mf">16.</span><span class="p">,</span><span class="mf">17.</span><span class="p">,</span><span class="mf">18.</span><span class="p">]</span> <span class="c1">## hours, where 18 h marks arrival</span>

<span class="c1">## select acceptable window of time</span>
<span class="n">Time_Window</span> <span class="o">=</span> <span class="mf">3.0</span>  <span class="c1">## hours</span>

<span class="c1">## set domain to be extracted</span>
<span class="n">Spat_Window</span> <span class="o">=</span> <span class="mf">125.0</span> <span class="c1">## km</span>

<span class="c1">## downscale to 1 km resolution (default: True)</span>
<span class="n">SAT_RES</span> <span class="o">=</span> <span class="mf">2.5</span>
<span class="n">upscale</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1">## repeat small domain output to match large domain (default: False)</span>
<span class="n">tiling</span> <span class="o">=</span> <span class="kc">False</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## convert to regular time</span>
<span class="n">tprop</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">toi</span> <span class="ow">in</span> <span class="n">Time_Vec</span><span class="p">:</span>
    <span class="n">tprop</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;2020-03-13T00:00:00&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">toi</span><span class="p">),</span><span class="s1">&#39;h&#39;</span><span class="p">))</span>
           
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## load all simulations located in subfolders of the given directory</span>

<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s2">&quot;/gpfsm/dhome/tflorian/LES-SCM/notebooks/&quot;</span><span class="p">)</span>
<span class="o">%</span><span class="k">run</span> functions_plotting.py 

<span class="n">var_vec_2d</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;alb&#39;</span><span class="p">,</span><span class="s1">&#39;opt&#39;</span><span class="p">]</span>

<span class="k">if</span> <span class="n">upscale</span><span class="p">:</span>
    <span class="n">df_col_2d</span> <span class="o">=</span> <span class="n">load_sims_2d</span><span class="p">(</span><span class="s1">&#39;/home/tflorian/LES-SCM/output_les/dharma/&#39;</span><span class="p">,</span><span class="n">var_vec_2d</span><span class="p">,</span><span class="n">t_shift</span><span class="o">=-</span><span class="mi">2</span><span class="p">,</span><span class="n">keyword</span><span class="o">=</span><span class="n">sim_keyword</span><span class="p">,</span><span class="n">times</span><span class="o">=</span><span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">Time_Vec</span> <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">],</span><span class="n">coarsen</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">df_col_2d</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">df_col_2d</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">df_col_2d</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">df_col_2d</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">df_col_2d</span> <span class="o">=</span> <span class="n">df_col_2d</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;y&#39;</span><span class="p">:</span><span class="s1">&#39;y_round&#39;</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">:</span><span class="s1">&#39;x_round&#39;</span><span class="p">})</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">df_col_2d</span> <span class="o">=</span> <span class="n">load_sims_2d</span><span class="p">(</span><span class="s1">&#39;/home/tflorian/LES-SCM/output_les/dharma/&#39;</span><span class="p">,</span><span class="n">var_vec_2d</span><span class="p">,</span><span class="n">t_shift</span><span class="o">=-</span><span class="mi">2</span><span class="p">,</span><span class="n">keyword</span><span class="o">=</span><span class="n">sim_keyword</span><span class="p">,</span><span class="n">times</span><span class="o">=</span><span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">Time_Vec</span> <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">],</span><span class="n">coarsen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Loading variables: f(time,x,y)
/home/tflorian/LES-SCM/output_les/dharma/comble_20200313_progNa_2D.nc
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/usr/local/other/anaconda/GEOSpyD/24.3.0-0/2024-08-29/envs/py3.12/lib/python3.12/site-packages/xarray/core/dataset.py:4789: UserWarning: No index created for dimension Source because variable Source is not a coordinate. To create an index for Source, please first call `.set_coords(&#39;Source&#39;)` on this object.
  warnings.warn(
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## for small domain simulations, repeat 2D output to match large domain (so-called &quot;tiling&quot;)</span>

<span class="k">for</span> <span class="n">si</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_col_2d</span><span class="p">[</span><span class="s1">&#39;Source&#39;</span><span class="p">])):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">df_col_2d</span><span class="p">[</span><span class="s1">&#39;Source&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">si</span><span class="p">])</span>
    <span class="n">x_act</span> <span class="o">=</span> <span class="n">df_col_2d</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Source</span><span class="o">=</span><span class="n">si</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;x_round&#39;</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)[</span><span class="s1">&#39;x_round&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">x_act</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">x_act</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">:</span>  <span class="c1">## nothing to be done, simply copy</span>
        <span class="n">df_sim</span> <span class="o">=</span> <span class="n">df_col_2d</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Source</span><span class="o">=</span><span class="n">si</span><span class="p">)</span><span class="o">.</span><span class="n">drop_vars</span><span class="p">(</span><span class="s1">&#39;Source&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>                 <span class="c1">## tile</span>
        <span class="k">for</span> <span class="n">ti</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_col_2d</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])):</span>
            <span class="n">df_core</span> <span class="o">=</span> <span class="n">df_col_2d</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Source</span><span class="o">=</span><span class="n">si</span><span class="p">)</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">ti</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">x_round</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">x_act</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">x_act</span><span class="p">)))</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">y_round</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">x_act</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">x_act</span><span class="p">)))</span><span class="o">.</span><span class="n">drop_vars</span><span class="p">([</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;Source&#39;</span><span class="p">])</span>
                    
            <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">xri</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>        
                <span class="n">df_copy</span> <span class="o">=</span> <span class="n">df_core</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">df_copy</span><span class="p">[</span><span class="s1">&#39;x_round&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">df_core</span><span class="p">[</span><span class="s1">&#39;x_round&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">xri</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">x_act</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">df_sim_tiled</span> <span class="o">=</span> <span class="n">df_copy</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">df_sim_tiled</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_sim_tiled</span><span class="p">,</span><span class="n">df_copy</span><span class="p">],</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;x_round&#39;</span><span class="p">,</span><span class="n">coords</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
                
            <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">yri</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>   
                <span class="n">df_copy</span> <span class="o">=</span> <span class="n">df_sim_tiled</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">df_copy</span><span class="p">[</span><span class="s1">&#39;y_round&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">df_core</span><span class="p">[</span><span class="s1">&#39;y_round&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">yri</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">x_act</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
                    
                <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">df_sim_tiled_2</span> <span class="o">=</span> <span class="n">df_copy</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">df_sim_tiled_2</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_sim_tiled_2</span><span class="p">,</span><span class="n">df_copy</span><span class="p">],</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;y_round&#39;</span><span class="p">,</span><span class="n">coords</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
                
            <span class="n">df_sim_tiled_2</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_col_2d</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ti</span><span class="p">]</span>
            <span class="n">df_sim_tiled_2</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_sim_tiled_2</span><span class="p">],</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="n">coords</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ti</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">df_sim_tcol</span> <span class="o">=</span> <span class="n">df_sim_tiled_2</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">df_sim_tcol</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_sim_tcol</span><span class="p">,</span><span class="n">df_sim_tiled_2</span><span class="p">],</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="n">coords</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
                
        <span class="n">df_sim</span> <span class="o">=</span> <span class="n">df_sim_tcol</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">df_sim</span><span class="p">[</span><span class="s1">&#39;Source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_col_2d</span><span class="p">[</span><span class="s1">&#39;Source&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">si</span><span class="p">]</span>
    <span class="n">df_sim</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_sim</span><span class="p">],</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;Source&#39;</span><span class="p">,</span><span class="n">coords</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">si</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">df_sim_scol</span> <span class="o">=</span> <span class="n">df_sim</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">df_sim_scol</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_sim_scol</span><span class="p">,</span><span class="n">df_sim</span><span class="p">],</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;Source&#39;</span><span class="p">,</span><span class="n">coords</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
        
<span class="k">if</span> <span class="n">tiling</span><span class="p">:</span>
    <span class="n">df_col_2d</span> <span class="o">=</span> <span class="n">df_sim_scol</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>comble_20200313_progNa_2D.nc
12.7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/usr/local/other/anaconda/GEOSpyD/24.3.0-0/2024-08-29/envs/py3.12/lib/python3.12/site-packages/xarray/core/dataset.py:4789: UserWarning: No index created for dimension time because variable time is not a coordinate. To create an index for time, please first call `.set_coords(&#39;time&#39;)` on this object.
  warnings.warn(
/usr/local/other/anaconda/GEOSpyD/24.3.0-0/2024-08-29/envs/py3.12/lib/python3.12/site-packages/xarray/core/dataset.py:4789: UserWarning: No index created for dimension time because variable time is not a coordinate. To create an index for time, please first call `.set_coords(&#39;time&#39;)` on this object.
  warnings.warn(
/usr/local/other/anaconda/GEOSpyD/24.3.0-0/2024-08-29/envs/py3.12/lib/python3.12/site-packages/xarray/core/dataset.py:4789: UserWarning: No index created for dimension time because variable time is not a coordinate. To create an index for time, please first call `.set_coords(&#39;time&#39;)` on this object.
  warnings.warn(
/usr/local/other/anaconda/GEOSpyD/24.3.0-0/2024-08-29/envs/py3.12/lib/python3.12/site-packages/xarray/core/dataset.py:4789: UserWarning: No index created for dimension time because variable time is not a coordinate. To create an index for time, please first call `.set_coords(&#39;time&#39;)` on this object.
  warnings.warn(
/usr/local/other/anaconda/GEOSpyD/24.3.0-0/2024-08-29/envs/py3.12/lib/python3.12/site-packages/xarray/core/dataset.py:4789: UserWarning: No index created for dimension time because variable time is not a coordinate. To create an index for time, please first call `.set_coords(&#39;time&#39;)` on this object.
  warnings.warn(
/usr/local/other/anaconda/GEOSpyD/24.3.0-0/2024-08-29/envs/py3.12/lib/python3.12/site-packages/xarray/core/dataset.py:4789: UserWarning: No index created for dimension time because variable time is not a coordinate. To create an index for time, please first call `.set_coords(&#39;time&#39;)` on this object.
  warnings.warn(
/usr/local/other/anaconda/GEOSpyD/24.3.0-0/2024-08-29/envs/py3.12/lib/python3.12/site-packages/xarray/core/dataset.py:4789: UserWarning: No index created for dimension time because variable time is not a coordinate. To create an index for time, please first call `.set_coords(&#39;time&#39;)` on this object.
  warnings.warn(
/usr/local/other/anaconda/GEOSpyD/24.3.0-0/2024-08-29/envs/py3.12/lib/python3.12/site-packages/xarray/core/dataset.py:4789: UserWarning: No index created for dimension time because variable time is not a coordinate. To create an index for time, please first call `.set_coords(&#39;time&#39;)` on this object.
  warnings.warn(
/usr/local/other/anaconda/GEOSpyD/24.3.0-0/2024-08-29/envs/py3.12/lib/python3.12/site-packages/xarray/core/dataset.py:4789: UserWarning: No index created for dimension time because variable time is not a coordinate. To create an index for time, please first call `.set_coords(&#39;time&#39;)` on this object.
  warnings.warn(
/usr/local/other/anaconda/GEOSpyD/24.3.0-0/2024-08-29/envs/py3.12/lib/python3.12/site-packages/xarray/core/dataset.py:4789: UserWarning: No index created for dimension time because variable time is not a coordinate. To create an index for time, please first call `.set_coords(&#39;time&#39;)` on this object.
  warnings.warn(
/usr/local/other/anaconda/GEOSpyD/24.3.0-0/2024-08-29/envs/py3.12/lib/python3.12/site-packages/xarray/core/dataset.py:4789: UserWarning: No index created for dimension time because variable time is not a coordinate. To create an index for time, please first call `.set_coords(&#39;time&#39;)` on this object.
  warnings.warn(
/usr/local/other/anaconda/GEOSpyD/24.3.0-0/2024-08-29/envs/py3.12/lib/python3.12/site-packages/xarray/core/dataset.py:4789: UserWarning: No index created for dimension time because variable time is not a coordinate. To create an index for time, please first call `.set_coords(&#39;time&#39;)` on this object.
  warnings.warn(
/usr/local/other/anaconda/GEOSpyD/24.3.0-0/2024-08-29/envs/py3.12/lib/python3.12/site-packages/xarray/core/dataset.py:4789: UserWarning: No index created for dimension time because variable time is not a coordinate. To create an index for time, please first call `.set_coords(&#39;time&#39;)` on this object.
  warnings.warn(
/usr/local/other/anaconda/GEOSpyD/24.3.0-0/2024-08-29/envs/py3.12/lib/python3.12/site-packages/xarray/core/dataset.py:4789: UserWarning: No index created for dimension time because variable time is not a coordinate. To create an index for time, please first call `.set_coords(&#39;time&#39;)` on this object.
  warnings.warn(
/usr/local/other/anaconda/GEOSpyD/24.3.0-0/2024-08-29/envs/py3.12/lib/python3.12/site-packages/xarray/core/dataset.py:4789: UserWarning: No index created for dimension time because variable time is not a coordinate. To create an index for time, please first call `.set_coords(&#39;time&#39;)` on this object.
  warnings.warn(
/usr/local/other/anaconda/GEOSpyD/24.3.0-0/2024-08-29/envs/py3.12/lib/python3.12/site-packages/xarray/core/dataset.py:4789: UserWarning: No index created for dimension time because variable time is not a coordinate. To create an index for time, please first call `.set_coords(&#39;time&#39;)` on this object.
  warnings.warn(
/usr/local/other/anaconda/GEOSpyD/24.3.0-0/2024-08-29/envs/py3.12/lib/python3.12/site-packages/xarray/core/dataset.py:4789: UserWarning: No index created for dimension time because variable time is not a coordinate. To create an index for time, please first call `.set_coords(&#39;time&#39;)` on this object.
  warnings.warn(
/usr/local/other/anaconda/GEOSpyD/24.3.0-0/2024-08-29/envs/py3.12/lib/python3.12/site-packages/xarray/core/dataset.py:4789: UserWarning: No index created for dimension time because variable time is not a coordinate. To create an index for time, please first call `.set_coords(&#39;time&#39;)` on this object.
  warnings.warn(
/usr/local/other/anaconda/GEOSpyD/24.3.0-0/2024-08-29/envs/py3.12/lib/python3.12/site-packages/xarray/core/dataset.py:4789: UserWarning: No index created for dimension Source because variable Source is not a coordinate. To create an index for Source, please first call `.set_coords(&#39;Source&#39;)` on this object.
  warnings.warn(
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># note: create directories automatically</span>
<span class="n">img_dir</span> <span class="o">=</span> <span class="s2">&quot;/css/modis/Collection6.1/L1/MOD021KM/2022/073/&quot;</span>
<span class="n">geo_dir</span> <span class="o">=</span> <span class="s2">&quot;/css/modis/Collection6.1/L1/MOD03/2022/073/&quot;</span>

<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">img_dir</span><span class="p">)</span>

<span class="n">da_stat_stst</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">counter_dat</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.hdf&quot;</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    
    <span class="c1">## load geolocation    </span>
    <span class="n">file_core</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="mi">9</span><span class="p">:</span><span class="mi">27</span><span class="p">]</span>
    <span class="c1">#print(file_core)</span>
    <span class="k">for</span> <span class="n">file_oi</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">geo_dir</span> <span class="o">+</span> <span class="s1">&#39;*&#39;</span> <span class="o">+</span> <span class="n">file_core</span> <span class="o">+</span> <span class="s1">&#39;*.hdf&#39;</span><span class="p">):</span>
        <span class="n">file_geo</span> <span class="o">=</span> <span class="n">file_oi</span>
        
    <span class="n">hdf</span> <span class="o">=</span> <span class="n">SD</span><span class="p">(</span><span class="n">file_geo</span><span class="p">,</span> <span class="n">SDC</span><span class="o">.</span><span class="n">READ</span><span class="p">)</span>
    <span class="n">lat</span> <span class="o">=</span> <span class="n">hdf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;Latitude&#39;</span><span class="p">)</span>
    <span class="n">latitude</span> <span class="o">=</span> <span class="n">lat</span><span class="p">[:,:]</span>
    <span class="n">lon</span> <span class="o">=</span> <span class="n">hdf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;Longitude&#39;</span><span class="p">)</span>
    <span class="n">longitude</span> <span class="o">=</span> <span class="n">lon</span><span class="p">[:,:]</span>
    
    <span class="c1">## load imagery</span>
    <span class="n">file_sp</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>   
    <span class="n">ds0</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">band_ds</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">ds0</span><span class="o">.</span><span class="n">GetSubDatasets</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GA_ReadOnly</span><span class="p">)</span>
    <span class="n">band_array</span> <span class="o">=</span> <span class="n">band_ds</span><span class="o">.</span><span class="n">ReadAsArray</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">)[</span><span class="mi">0</span><span class="p">,:,:]</span>
    
    <span class="c1">## time</span>
    <span class="n">file_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;2020-01-01&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">file_sp</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">5</span><span class="p">:</span><span class="mi">8</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;D&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">file_sp</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]),</span><span class="s1">&#39;h&#39;</span><span class="p">)</span><span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">file_sp</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]),</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>

    <span class="c1">## for each requested model timestep, check if image covers right place at right time</span>
    <span class="n">counter_time</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">Time_OI</span> <span class="ow">in</span> <span class="n">tprop</span><span class="p">:</span>
        <span class="n">diff_time</span> <span class="o">=</span> <span class="p">(</span><span class="n">file_time</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="n">Time_OI</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">)</span><span class="o">/</span><span class="mi">3600</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">diff_time</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">Time_Window</span><span class="p">:</span>
            
            <span class="n">Traj_time</span> <span class="o">=</span> <span class="p">(</span><span class="n">Time_OI</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;2020-03-13T18:00:00&#39;</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">)</span><span class="o">/</span><span class="mi">3600</span>
            <span class="n">Lat_OI</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;Latitude&#39;</span><span class="p">][</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">][:]</span><span class="o">==</span><span class="n">Traj_time</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">Lon_OI</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;Longitude&#39;</span><span class="p">][</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">][:]</span><span class="o">==</span><span class="n">Traj_time</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            
            <span class="c1">## create spatial window around coordinate of interest</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">geopy</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="n">Lat_OI</span><span class="p">,</span> <span class="n">Lon_OI</span><span class="p">)</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">geopy</span><span class="o">.</span><span class="n">distance</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">kilometers</span><span class="o">=</span><span class="mf">1.2</span><span class="o">*</span><span class="n">Spat_Window</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            
            <span class="n">LAT_MIN</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">destination</span><span class="p">(</span><span class="n">point</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">bearing</span><span class="o">=</span><span class="mi">180</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">LAT_MAX</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">destination</span><span class="p">(</span><span class="n">point</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">bearing</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">LON_MIN</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">destination</span><span class="p">(</span><span class="n">point</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">bearing</span><span class="o">=</span><span class="mi">270</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">LON_MAX</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">destination</span><span class="p">(</span><span class="n">point</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">bearing</span><span class="o">=</span><span class="mi">90</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            
            <span class="c1">## select pixels within window</span>
            <span class="n">pix_num</span> <span class="o">=</span> <span class="p">((</span><span class="n">latitude</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="n">LAT_MIN</span><span class="p">)</span> <span class="o">&amp;</span> 
                       <span class="p">(</span><span class="n">latitude</span><span class="p">[:]</span> <span class="o">&lt;</span> <span class="n">LAT_MAX</span><span class="p">)</span> <span class="o">&amp;</span> 
                       <span class="p">(</span><span class="n">longitude</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="n">LON_MIN</span><span class="p">)</span><span class="o">&amp;</span> 
                       <span class="p">(</span><span class="n">longitude</span><span class="p">[:]</span> <span class="o">&lt;</span> <span class="n">LON_MAX</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
             
            <span class="k">if</span> <span class="n">pix_num</span> <span class="o">&gt;</span> <span class="mi">10000</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">Time_OI</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">pix_num</span><span class="p">)</span>
                <span class="n">ds_sub</span> <span class="o">=</span> <span class="n">band_array</span><span class="p">[:,:][(</span><span class="n">latitude</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="n">LAT_MIN</span><span class="p">)</span> <span class="o">&amp;</span> 
                                          <span class="p">(</span><span class="n">latitude</span><span class="p">[:]</span> <span class="o">&lt;</span> <span class="n">LAT_MAX</span><span class="p">)</span> <span class="o">&amp;</span> 
                                          <span class="p">(</span><span class="n">longitude</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="n">LON_MIN</span><span class="p">)</span> <span class="o">&amp;</span> 
                                          <span class="p">(</span><span class="n">longitude</span><span class="p">[:]</span> <span class="o">&lt;</span> <span class="n">LON_MAX</span><span class="p">)]</span>
                
                <span class="n">ds_lat</span> <span class="o">=</span> <span class="n">latitude</span><span class="p">[:,:][(</span><span class="n">latitude</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="n">LAT_MIN</span><span class="p">)</span> <span class="o">&amp;</span> 
                                          <span class="p">(</span><span class="n">latitude</span><span class="p">[:]</span> <span class="o">&lt;</span> <span class="n">LAT_MAX</span><span class="p">)</span> <span class="o">&amp;</span> 
                                          <span class="p">(</span><span class="n">longitude</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="n">LON_MIN</span><span class="p">)</span> <span class="o">&amp;</span> 
                                          <span class="p">(</span><span class="n">longitude</span><span class="p">[:]</span> <span class="o">&lt;</span> <span class="n">LON_MAX</span><span class="p">)]</span>
                <span class="n">ds_lon</span> <span class="o">=</span> <span class="n">longitude</span><span class="p">[:,:][(</span><span class="n">latitude</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="n">LAT_MIN</span><span class="p">)</span> <span class="o">&amp;</span> 
                                          <span class="p">(</span><span class="n">latitude</span><span class="p">[:]</span> <span class="o">&lt;</span> <span class="n">LAT_MAX</span><span class="p">)</span> <span class="o">&amp;</span> 
                                          <span class="p">(</span><span class="n">longitude</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="n">LON_MIN</span><span class="p">)</span> <span class="o">&amp;</span> 
                                          <span class="p">(</span><span class="n">longitude</span><span class="p">[:]</span> <span class="o">&lt;</span> <span class="n">LON_MAX</span><span class="p">)]</span>
                <span class="n">da</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;alb&#39;</span><span class="p">,</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">ds_sub</span><span class="p">,</span>
                    <span class="n">dims</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;pixel&#39;</span><span class="p">],</span>
                    <span class="n">coords</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                        <span class="n">lon</span> <span class="o">=</span> <span class="p">([</span><span class="s1">&#39;pixel&#39;</span><span class="p">],</span><span class="n">ds_lon</span><span class="p">),</span>
                        <span class="n">lat</span> <span class="o">=</span> <span class="p">([</span><span class="s1">&#39;pixel&#39;</span><span class="p">],</span><span class="n">ds_lat</span><span class="p">)</span>
                    <span class="p">))</span>
            
                <span class="c1">## compute meridional and latitudal distance to center</span>
                <span class="n">da</span><span class="p">[</span><span class="s1">&#39;x_dist&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="o">*</span><span class="n">da</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span>
                <span class="n">da</span><span class="p">[</span><span class="s1">&#39;y_dist&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="o">*</span><span class="n">da</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ds_sub</span><span class="p">)):</span>
                    <span class="n">da</span><span class="p">[</span><span class="s1">&#39;x_dist&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">geopy</span><span class="o">.</span><span class="n">distance</span><span class="o">.</span><span class="n">geodesic</span><span class="p">((</span><span class="n">da</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">],</span><span class="n">da</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">]),</span> 
                                                               <span class="p">(</span><span class="n">da</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">],</span><span class="n">Lon_OI</span><span class="p">))</span><span class="o">.</span><span class="n">km</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">((</span><span class="n">da</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">-</span> <span class="n">Lon_OI</span><span class="p">))</span>
                    <span class="n">da</span><span class="p">[</span><span class="s1">&#39;y_dist&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">geopy</span><span class="o">.</span><span class="n">distance</span><span class="o">.</span><span class="n">geodesic</span><span class="p">((</span><span class="n">da</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">],</span><span class="n">da</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">]),</span> 
                                                               <span class="p">(</span><span class="n">Lat_OI</span><span class="p">,</span><span class="n">da</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">]))</span><span class="o">.</span><span class="n">km</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">((</span><span class="n">da</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">-</span> <span class="n">Lat_OI</span><span class="p">))</span> 
                
                <span class="c1">## limit to requested size</span>
                <span class="n">da</span> <span class="o">=</span> <span class="n">da</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">da</span><span class="p">[</span><span class="s1">&#39;x_dist&#39;</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="n">Spat_Window</span><span class="o">/</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">da</span> <span class="o">=</span> <span class="n">da</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">da</span><span class="p">[</span><span class="s1">&#39;y_dist&#39;</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="n">Spat_Window</span><span class="o">/</span><span class="mi">2</span><span class="p">]</span>
                
                <span class="c1">## normalize radiance values to resemble LES pseudo-albedo</span>
                <span class="c1">## (using quantiles to avoid dominance of few bright pixels)</span>
                <span class="n">fact</span> <span class="o">=</span> <span class="mf">0.9</span>
                <span class="k">if</span> <span class="n">Time_OI</span> <span class="ow">in</span> <span class="n">df_col_2d</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]:</span>
                    <span class="n">fact</span> <span class="o">=</span> <span class="n">df_col_2d</span><span class="p">[</span><span class="s1">&#39;alb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">Time_OI</span><span class="p">)</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span><span class="o">.</span><span class="n">data</span>
                <span class="n">da</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">((</span><span class="n">da</span><span class="o">.</span><span class="n">data</span> <span class="o">-</span> <span class="n">da</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">/</span><span class="p">(</span><span class="n">da</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span><span class="o">.</span><span class="n">data</span> <span class="o">-</span> <span class="n">da</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">min</span><span class="p">()))</span><span class="o">*</span><span class="n">fact</span>
                    
                <span class="n">da</span><span class="p">[</span><span class="s1">&#39;x_round&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">da</span><span class="p">[</span><span class="s1">&#39;x_dist&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">SAT_RES</span><span class="p">)</span><span class="o">*</span><span class="n">SAT_RES</span>
                <span class="n">da</span><span class="p">[</span><span class="s1">&#39;y_round&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">da</span><span class="p">[</span><span class="s1">&#39;y_dist&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">SAT_RES</span><span class="p">)</span><span class="o">*</span><span class="n">SAT_RES</span>
                
                <span class="k">for</span> <span class="n">yy</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">da</span><span class="p">[</span><span class="s1">&#39;y_round&#39;</span><span class="p">]):</span>
                    <span class="n">da_sub</span> <span class="o">=</span> <span class="n">da</span><span class="p">[</span><span class="n">da</span><span class="p">[</span><span class="s1">&#39;y_round&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">yy</span><span class="p">]</span>
                    <span class="n">da_stat</span> <span class="o">=</span> <span class="n">da_sub</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;x_round&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> 
                    <span class="n">da_stat</span><span class="p">[</span><span class="s1">&#39;y_round&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">yy</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">yy</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">da</span><span class="p">[</span><span class="s1">&#39;y_round&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="n">da_stat_stack</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">da_stat</span><span class="p">],</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;y_round&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">da_stat_stack</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">da_stat_stack</span><span class="p">,</span><span class="n">da_stat</span><span class="p">],</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;y_round&#39;</span><span class="p">)</span>
                    
                <span class="k">if</span> <span class="n">upscale</span><span class="p">:</span>
                    <span class="n">x_round_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">da_stat_stack</span><span class="o">.</span><span class="n">x_round</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">da_stat_stack</span><span class="o">.</span><span class="n">x_round</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">10</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">da_stat_stack</span><span class="p">[</span><span class="s1">&#39;x_round&#39;</span><span class="p">])</span><span class="o">-</span><span class="mi">9</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># da_stat_stack[&quot;x_round&quot;] * 4)</span>
                    <span class="n">y_round_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">da_stat_stack</span><span class="o">.</span><span class="n">y_round</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">da_stat_stack</span><span class="o">.</span><span class="n">y_round</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">10</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">da_stat_stack</span><span class="p">[</span><span class="s1">&#39;y_round&#39;</span><span class="p">])</span><span class="o">-</span><span class="mi">9</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># da_stat_stack[&quot;x_round&quot;] * 4)</span>
                    <span class="n">da_stat_stack</span> <span class="o">=</span> <span class="n">da_stat_stack</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">x_round</span><span class="o">=</span><span class="n">x_round_new</span><span class="p">,</span><span class="n">y_round</span><span class="o">=</span><span class="n">y_round_new</span><span class="p">)</span>
                                        
                <span class="n">da_stat_stack</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Time_OI</span>
                <span class="n">da_stat_stack</span><span class="p">[</span><span class="s1">&#39;time_diff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">diff_time</span>
                <span class="k">if</span> <span class="n">counter_time</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">da_stat_stst</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">da_stat_stack</span><span class="p">],</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">da_stat_stst</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">da_stat_stst</span><span class="p">,</span><span class="n">da_stat_stack</span><span class="p">],</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
                <span class="n">counter_time</span> <span class="o">+=</span> <span class="mi">1</span>
                
                <span class="n">da_stat_stst</span><span class="p">[</span><span class="s1">&#39;Source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_sp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="n">file_sp</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">counter_dat</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">da_stat_ststst</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">da_stat_stst</span><span class="p">],</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;Source&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">da_stat_ststst</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">da_stat_ststst</span><span class="p">,</span><span class="n">da_stat_stst</span><span class="p">],</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;Source&#39;</span><span class="p">)</span>
                <span class="n">counter_dat</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MOD021KM.A2022073.0100.061.2022073133830.hdf
MOD021KM.A2022073.2220.061.2022074073450.hdf
MOD021KM.A2022073.1055.061.2022073194333.hdf
MOD021KM.A2022073.0555.061.2022073133847.hdf
MOD021KM.A2022073.1430.061.2022074014644.hdf
MOD021KM.A2022073.0120.061.2022073133825.hdf
MOD021KM.A2022073.0240.061.2022073133831.hdf
MOD021KM.A2022073.2110.061.2022074073434.hdf
MOD021KM.A2022073.1855.061.2022074073402.hdf
MOD021KM.A2022073.1535.061.2022074014007.hdf
MOD021KM.A2022073.2355.061.2022074073432.hdf
MOD021KM.A2022073.0550.061.2022073133826.hdf
MOD021KM.A2022073.0725.061.2022073194317.hdf
MOD021KM.A2022073.0115.061.2022073133908.hdf
MOD021KM.A2022073.1250.061.2022074014551.hdf
MOD021KM.A2022073.0230.061.2022073133902.hdf
MOD021KM.A2022073.0255.061.2022073133920.hdf
MOD021KM.A2022073.1425.061.2022074014515.hdf
MOD021KM.A2022073.1240.061.2022074014058.hdf
MOD021KM.A2022073.1050.061.2022073194315.hdf
MOD021KM.A2022073.0110.061.2022073133916.hdf
MOD021KM.A2022073.1730.061.2022074014135.hdf
MOD021KM.A2022073.1735.061.2022074014111.hdf
MOD021KM.A2022073.0745.061.2022073194350.hdf
MOD021KM.A2022073.0905.061.2022073194207.hdf
MOD021KM.A2022073.2035.061.2022074073449.hdf
MOD021KM.A2022073.0105.061.2022073133912.hdf
MOD021KM.A2022073.0735.061.2022073194422.hdf
MOD021KM.A2022073.1110.061.2022073194243.hdf
MOD021KM.A2022073.0915.061.2022073194240.hdf
MOD021KM.A2022073.1040.061.2022073194435.hdf
2020-03-13T08:00:00
16000
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/gpfsm/dnb33/tdirs/batch/slurm.45618156.tflorian/ipykernel_15162/4275271187.py:120: UserWarning: Converting non-nanosecond precision datetime values to nanosecond precision. This behavior can eventually be relaxed in xarray, as it is an artifact from pandas which is now beginning to support non-nanosecond precision values. This warning is caused by passing non-nanosecond np.datetime64 or np.timedelta64 values to the DataArray or Variable constructor; it can be silenced by converting the values to nanosecond precision ahead of time.
  da_stat_stack[&#39;time&#39;] = Time_OI
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2020-03-13T09:00:00
16932
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/gpfsm/dnb33/tdirs/batch/slurm.45618156.tflorian/ipykernel_15162/4275271187.py:120: UserWarning: Converting non-nanosecond precision datetime values to nanosecond precision. This behavior can eventually be relaxed in xarray, as it is an artifact from pandas which is now beginning to support non-nanosecond precision values. This warning is caused by passing non-nanosecond np.datetime64 or np.timedelta64 values to the DataArray or Variable constructor; it can be silenced by converting the values to nanosecond precision ahead of time.
  da_stat_stack[&#39;time&#39;] = Time_OI
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2020-03-13T10:00:00
17806
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/gpfsm/dnb33/tdirs/batch/slurm.45618156.tflorian/ipykernel_15162/4275271187.py:120: UserWarning: Converting non-nanosecond precision datetime values to nanosecond precision. This behavior can eventually be relaxed in xarray, as it is an artifact from pandas which is now beginning to support non-nanosecond precision values. This warning is caused by passing non-nanosecond np.datetime64 or np.timedelta64 values to the DataArray or Variable constructor; it can be silenced by converting the values to nanosecond precision ahead of time.
  da_stat_stack[&#39;time&#39;] = Time_OI
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2020-03-13T11:00:00
18637
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/gpfsm/dnb33/tdirs/batch/slurm.45618156.tflorian/ipykernel_15162/4275271187.py:120: UserWarning: Converting non-nanosecond precision datetime values to nanosecond precision. This behavior can eventually be relaxed in xarray, as it is an artifact from pandas which is now beginning to support non-nanosecond precision values. This warning is caused by passing non-nanosecond np.datetime64 or np.timedelta64 values to the DataArray or Variable constructor; it can be silenced by converting the values to nanosecond precision ahead of time.
  da_stat_stack[&#39;time&#39;] = Time_OI
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2020-03-13T12:00:00
19407
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/gpfsm/dnb33/tdirs/batch/slurm.45618156.tflorian/ipykernel_15162/4275271187.py:120: UserWarning: Converting non-nanosecond precision datetime values to nanosecond precision. This behavior can eventually be relaxed in xarray, as it is an artifact from pandas which is now beginning to support non-nanosecond precision values. This warning is caused by passing non-nanosecond np.datetime64 or np.timedelta64 values to the DataArray or Variable constructor; it can be silenced by converting the values to nanosecond precision ahead of time.
  da_stat_stack[&#39;time&#39;] = Time_OI
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2020-03-13T13:00:00
20074
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/gpfsm/dnb33/tdirs/batch/slurm.45618156.tflorian/ipykernel_15162/4275271187.py:120: UserWarning: Converting non-nanosecond precision datetime values to nanosecond precision. This behavior can eventually be relaxed in xarray, as it is an artifact from pandas which is now beginning to support non-nanosecond precision values. This warning is caused by passing non-nanosecond np.datetime64 or np.timedelta64 values to the DataArray or Variable constructor; it can be silenced by converting the values to nanosecond precision ahead of time.
  da_stat_stack[&#39;time&#39;] = Time_OI
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MOD021KM.A2022073.0415.061.2022073133814.hdf
MOD021KM.A2022073.1715.061.2022074014109.hdf
MOD021KM.A2022073.0610.061.2022073194341.hdf
MOD021KM.A2022073.0615.061.2022073194425.hdf
MOD021KM.A2022073.0250.061.2022073133914.hdf
MOD021KM.A2022073.1605.061.2022074014146.hdf
MOD021KM.A2022073.0235.061.2022073133831.hdf
MOD021KM.A2022073.1555.061.2022074014133.hdf
MOD021KM.A2022073.0245.061.2022073133821.hdf
MOD021KM.A2022073.1725.061.2022074014307.hdf
MOD021KM.A2022073.0410.061.2022073133812.hdf
MOD021KM.A2022073.1435.061.2022074014525.hdf
MOD021KM.A2022073.0925.061.2022073194414.hdf
MOD021KM.A2022073.0750.061.2022073194413.hdf
MOD021KM.A2022073.1045.061.2022073194413.hdf
MOD021KM.A2022073.1255.061.2022074014552.hdf
MOD021KM.A2022073.0930.061.2022073194347.hdf
MOD021KM.A2022073.2350.061.2022074073430.hdf
MOD021KM.A2022073.0050.061.2022073133820.hdf
MOD021KM.A2022073.1900.061.2022074073409.hdf
MOD021KM.A2022073.1910.061.2022074073410.hdf
MOD021KM.A2022073.1225.061.2022074014116.hdf
MOD021KM.A2022073.0225.061.2022073133859.hdf
MOD021KM.A2022073.1905.061.2022074073400.hdf
MOD021KM.A2022073.2040.061.2022074073446.hdf
MOD021KM.A2022073.0545.061.2022073133916.hdf
MOD021KM.A2022073.1220.061.2022074014610.hdf
2020-03-13T10:00:00
16785
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/gpfsm/dnb33/tdirs/batch/slurm.45618156.tflorian/ipykernel_15162/4275271187.py:120: UserWarning: Converting non-nanosecond precision datetime values to nanosecond precision. This behavior can eventually be relaxed in xarray, as it is an artifact from pandas which is now beginning to support non-nanosecond precision values. This warning is caused by passing non-nanosecond np.datetime64 or np.timedelta64 values to the DataArray or Variable constructor; it can be silenced by converting the values to nanosecond precision ahead of time.
  da_stat_stack[&#39;time&#39;] = Time_OI
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2020-03-13T11:00:00
15540
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/gpfsm/dnb33/tdirs/batch/slurm.45618156.tflorian/ipykernel_15162/4275271187.py:120: UserWarning: Converting non-nanosecond precision datetime values to nanosecond precision. This behavior can eventually be relaxed in xarray, as it is an artifact from pandas which is now beginning to support non-nanosecond precision values. This warning is caused by passing non-nanosecond np.datetime64 or np.timedelta64 values to the DataArray or Variable constructor; it can be silenced by converting the values to nanosecond precision ahead of time.
  da_stat_stack[&#39;time&#39;] = Time_OI
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2020-03-13T12:00:00
14352
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/gpfsm/dnb33/tdirs/batch/slurm.45618156.tflorian/ipykernel_15162/4275271187.py:120: UserWarning: Converting non-nanosecond precision datetime values to nanosecond precision. This behavior can eventually be relaxed in xarray, as it is an artifact from pandas which is now beginning to support non-nanosecond precision values. This warning is caused by passing non-nanosecond np.datetime64 or np.timedelta64 values to the DataArray or Variable constructor; it can be silenced by converting the values to nanosecond precision ahead of time.
  da_stat_stack[&#39;time&#39;] = Time_OI
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2020-03-13T13:00:00
13256
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/gpfsm/dnb33/tdirs/batch/slurm.45618156.tflorian/ipykernel_15162/4275271187.py:120: UserWarning: Converting non-nanosecond precision datetime values to nanosecond precision. This behavior can eventually be relaxed in xarray, as it is an artifact from pandas which is now beginning to support non-nanosecond precision values. This warning is caused by passing non-nanosecond np.datetime64 or np.timedelta64 values to the DataArray or Variable constructor; it can be silenced by converting the values to nanosecond precision ahead of time.
  da_stat_stack[&#39;time&#39;] = Time_OI
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2020-03-13T14:00:00
12246
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/gpfsm/dnb33/tdirs/batch/slurm.45618156.tflorian/ipykernel_15162/4275271187.py:120: UserWarning: Converting non-nanosecond precision datetime values to nanosecond precision. This behavior can eventually be relaxed in xarray, as it is an artifact from pandas which is now beginning to support non-nanosecond precision values. This warning is caused by passing non-nanosecond np.datetime64 or np.timedelta64 values to the DataArray or Variable constructor; it can be silenced by converting the values to nanosecond precision ahead of time.
  da_stat_stack[&#39;time&#39;] = Time_OI
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2020-03-13T15:00:00
11294
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/gpfsm/dnb33/tdirs/batch/slurm.45618156.tflorian/ipykernel_15162/4275271187.py:120: UserWarning: Converting non-nanosecond precision datetime values to nanosecond precision. This behavior can eventually be relaxed in xarray, as it is an artifact from pandas which is now beginning to support non-nanosecond precision values. This warning is caused by passing non-nanosecond np.datetime64 or np.timedelta64 values to the DataArray or Variable constructor; it can be silenced by converting the values to nanosecond precision ahead of time.
  da_stat_stack[&#39;time&#39;] = Time_OI
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MOD021KM.A2022073.2240.061.2022074073446.hdf
MOD021KM.A2022073.0900.061.2022073194258.hdf
MOD021KM.A2022073.1230.061.2022074014429.hdf
MOD021KM.A2022073.0920.061.2022073194351.hdf
MOD021KM.A2022073.0740.061.2022073194327.hdf
MOD021KM.A2022073.2215.061.2022074073420.hdf
MOD021KM.A2022073.1400.061.2022074014230.hdf
MOD021KM.A2022073.0055.061.2022073133826.hdf
MOD021KM.A2022073.0420.061.2022073133912.hdf
MOD021KM.A2022073.1600.061.2022074014412.hdf
MOD021KM.A2022073.0935.061.2022073194348.hdf
MOD021KM.A2022073.1245.061.2022074014605.hdf
MOD021KM.A2022073.0605.061.2022073194407.hdf
MOD021KM.A2022073.1410.061.2022074014528.hdf
MOD021KM.A2022073.0405.061.2022073133847.hdf
MOD021KM.A2022073.2245.061.2022074073432.hdf
MOD021KM.A2022073.1405.061.2022074014222.hdf
MOD021KM.A2022073.0755.061.2022073194411.hdf
MOD021KM.A2022073.1415.061.2022074014556.hdf
MOD021KM.A2022073.1720.061.2022074014239.hdf
MOD021KM.A2022073.1235.061.2022074014616.hdf
MOD021KM.A2022073.1540.061.2022074014306.hdf
MOD021KM.A2022073.1550.061.2022074014300.hdf
MOD021KM.A2022073.0425.061.2022073133850.hdf
MOD021KM.A2022073.0600.061.2022073194353.hdf
MOD021KM.A2022073.0910.061.2022073194341.hdf
MOD021KM.A2022073.1100.061.2022073194408.hdf
MOD021KM.A2022073.1545.061.2022074014503.hdf
MOD021KM.A2022073.2105.061.2022074073425.hdf
MOD021KM.A2022073.0730.061.2022073194220.hdf
MOD021KM.A2022073.1120.061.2022073194300.hdf
MOD021KM.A2022073.0300.061.2022073133839.hdf
MOD021KM.A2022073.1420.061.2022074014203.hdf
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">da_stat_ststst</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Source</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
html[data-theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray &#x27;alb&#x27; (time: 10, y_round: 501, x_round: 501)&gt; Size: 20MB
array([[[       nan,        nan,        nan, ...,        nan,
                nan,        nan],
        [       nan,        nan,        nan, ...,        nan,
                nan,        nan],
        [       nan,        nan,        nan, ...,        nan,
                nan,        nan],
        ...,
        [       nan,        nan,        nan, ...,        nan,
                nan,        nan],
        [       nan,        nan,        nan, ...,        nan,
                nan,        nan],
        [       nan,        nan,        nan, ...,        nan,
                nan,        nan]],

       [[       nan,        nan,        nan, ...,        nan,
                nan,        nan],
        [       nan,        nan,        nan, ...,        nan,
                nan,        nan],
        [       nan,        nan,        nan, ...,        nan,
                nan,        nan],
...
        [       nan,        nan,        nan, ...,        nan,
                nan,        nan],
        [       nan,        nan,        nan, ...,        nan,
                nan,        nan],
        [       nan,        nan,        nan, ...,        nan,
                nan,        nan]],

       [[       nan,        nan,        nan, ...,        nan,
                nan,        nan],
        [       nan,        nan,        nan, ...,        nan,
                nan,        nan],
        [       nan,        nan,        nan, ...,        nan,
                nan,        nan],
        ...,
        [       nan,        nan,        nan, ...,        nan,
                nan,        nan],
        [       nan,        nan,        nan, ...,        nan,
                nan,        nan],
        [       nan,        nan,        nan, ...,        nan,
                nan,        nan]]])
Coordinates:
  * x_round    (x_round) float64 4kB -62.5 -62.2 -62.0 -61.8 ... 62.0 62.2 62.5
  * y_round    (y_round) float64 4kB -62.5 -62.2 -62.0 -61.8 ... 62.0 62.2 62.5
  * time       (time) datetime64[ns] 80B 2020-03-13T06:00:00 ... 2020-03-13T1...
    Source     &lt;U13 52B &#x27;A2022073.1040&#x27;
    time_diff  (time) float64 80B nan nan 2.667 1.667 0.6667 nan nan nan nan nan</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'>'alb'</div><ul class='xr-dim-list'><li><span class='xr-has-index'>time</span>: 10</li><li><span class='xr-has-index'>y_round</span>: 501</li><li><span class='xr-has-index'>x_round</span>: 501</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-95fdc6a8-564e-4d03-b5ce-f4a5d3b3dee5' class='xr-array-in' type='checkbox' checked><label for='section-95fdc6a8-564e-4d03-b5ce-f4a5d3b3dee5' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>nan nan nan nan nan nan nan nan ... nan nan nan nan nan nan nan nan</span></div><div class='xr-array-data'><pre>array([[[       nan,        nan,        nan, ...,        nan,
                nan,        nan],
        [       nan,        nan,        nan, ...,        nan,
                nan,        nan],
        [       nan,        nan,        nan, ...,        nan,
                nan,        nan],
        ...,
        [       nan,        nan,        nan, ...,        nan,
                nan,        nan],
        [       nan,        nan,        nan, ...,        nan,
                nan,        nan],
        [       nan,        nan,        nan, ...,        nan,
                nan,        nan]],

       [[       nan,        nan,        nan, ...,        nan,
                nan,        nan],
        [       nan,        nan,        nan, ...,        nan,
                nan,        nan],
        [       nan,        nan,        nan, ...,        nan,
                nan,        nan],
...
        [       nan,        nan,        nan, ...,        nan,
                nan,        nan],
        [       nan,        nan,        nan, ...,        nan,
                nan,        nan],
        [       nan,        nan,        nan, ...,        nan,
                nan,        nan]],

       [[       nan,        nan,        nan, ...,        nan,
                nan,        nan],
        [       nan,        nan,        nan, ...,        nan,
                nan,        nan],
        [       nan,        nan,        nan, ...,        nan,
                nan,        nan],
        ...,
        [       nan,        nan,        nan, ...,        nan,
                nan,        nan],
        [       nan,        nan,        nan, ...,        nan,
                nan,        nan],
        [       nan,        nan,        nan, ...,        nan,
                nan,        nan]]])</pre></div></div></li><li class='xr-section-item'><input id='section-80c43110-722f-49b8-a81e-c496a4336e47' class='xr-section-summary-in' type='checkbox'  checked><label for='section-80c43110-722f-49b8-a81e-c496a4336e47' class='xr-section-summary' >Coordinates: <span>(5)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>x_round</span></div><div class='xr-var-dims'>(x_round)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>-62.5 -62.2 -62.0 ... 62.2 62.5</div><input id='attrs-1c3b9833-fc07-4ff9-9724-b6e38503a2a5' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-1c3b9833-fc07-4ff9-9724-b6e38503a2a5' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-b8d96dcf-5e6d-4488-87b0-3cfd45c74fc0' class='xr-var-data-in' type='checkbox'><label for='data-b8d96dcf-5e6d-4488-87b0-3cfd45c74fc0' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([-62.5, -62.2, -62. , ...,  62. ,  62.2,  62.5])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>y_round</span></div><div class='xr-var-dims'>(y_round)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>-62.5 -62.2 -62.0 ... 62.2 62.5</div><input id='attrs-c9ac43b0-7215-42f7-b5e5-4f0b6d7c250b' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-c9ac43b0-7215-42f7-b5e5-4f0b6d7c250b' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-7b45d5ae-09d3-49ec-9092-7a61a862abb0' class='xr-var-data-in' type='checkbox'><label for='data-7b45d5ae-09d3-49ec-9092-7a61a862abb0' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([-62.5, -62.2, -62. , ...,  62. ,  62.2,  62.5])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>datetime64[ns]</div><div class='xr-var-preview xr-preview'>2020-03-13T06:00:00 ... 2020-03-...</div><input id='attrs-8be84719-bd03-40db-be21-436622ad744f' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-8be84719-bd03-40db-be21-436622ad744f' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-9215f8fa-7804-43a8-aefe-4a366048ea32' class='xr-var-data-in' type='checkbox'><label for='data-9215f8fa-7804-43a8-aefe-4a366048ea32' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;2020-03-13T06:00:00.000000000&#x27;, &#x27;2020-03-13T07:00:00.000000000&#x27;,
       &#x27;2020-03-13T08:00:00.000000000&#x27;, &#x27;2020-03-13T09:00:00.000000000&#x27;,
       &#x27;2020-03-13T10:00:00.000000000&#x27;, &#x27;2020-03-13T11:00:00.000000000&#x27;,
       &#x27;2020-03-13T12:00:00.000000000&#x27;, &#x27;2020-03-13T13:00:00.000000000&#x27;,
       &#x27;2020-03-13T14:00:00.000000000&#x27;, &#x27;2020-03-13T15:00:00.000000000&#x27;],
      dtype=&#x27;datetime64[ns]&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>Source</span></div><div class='xr-var-dims'>()</div><div class='xr-var-dtype'>&lt;U13</div><div class='xr-var-preview xr-preview'>&#x27;A2022073.1040&#x27;</div><input id='attrs-7bfa53dc-e9f4-4e58-846c-5f72faeae6d1' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-7bfa53dc-e9f4-4e58-846c-5f72faeae6d1' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-8989d2c3-78db-4509-a69e-1a9f44b4b8d2' class='xr-var-data-in' type='checkbox'><label for='data-8989d2c3-78db-4509-a69e-1a9f44b4b8d2' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array(&#x27;A2022073.1040&#x27;, dtype=&#x27;&lt;U13&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>time_diff</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>nan nan 2.667 1.667 ... nan nan nan</div><input id='attrs-37483bfe-5349-4894-9d62-00e41c956be8' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-37483bfe-5349-4894-9d62-00e41c956be8' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-1c6f6f0f-3ff4-4552-a139-60499b131308' class='xr-var-data-in' type='checkbox'><label for='data-1c6f6f0f-3ff4-4552-a139-60499b131308' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([       nan,        nan, 2.66666667, 1.66666667, 0.66666667,
              nan,        nan,        nan,        nan,        nan])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-79c99ca0-d1a9-42b2-80ec-b4b3c31cfb2f' class='xr-section-summary-in' type='checkbox'  ><label for='section-79c99ca0-d1a9-42b2-80ec-b4b3c31cfb2f' class='xr-section-summary' >Indexes: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>x_round</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-9f6504c2-5593-4166-ac74-77ce59d019b7' class='xr-index-data-in' type='checkbox'/><label for='index-9f6504c2-5593-4166-ac74-77ce59d019b7' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([-62.5, -62.2, -62.0, -61.8, -61.5, -61.2, -61.0, -60.8, -60.5, -60.2,
       ...
        60.2,  60.5,  60.8,  61.0,  61.2,  61.5,  61.8,  62.0,  62.2,  62.5],
      dtype=&#x27;float64&#x27;, name=&#x27;x_round&#x27;, length=501))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>y_round</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-fd058ac2-9de5-4f36-aeab-96381dafe59e' class='xr-index-data-in' type='checkbox'/><label for='index-fd058ac2-9de5-4f36-aeab-96381dafe59e' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([-62.5, -62.2, -62.0, -61.8, -61.5, -61.2, -61.0, -60.8, -60.5, -60.2,
       ...
        60.2,  60.5,  60.8,  61.0,  61.2,  61.5,  61.8,  62.0,  62.2,  62.5],
      dtype=&#x27;float64&#x27;, name=&#x27;y_round&#x27;, length=501))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>time</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-ba54c9e6-bacc-4f75-90c2-79e708c1d7b8' class='xr-index-data-in' type='checkbox'/><label for='index-ba54c9e6-bacc-4f75-90c2-79e708c1d7b8' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(DatetimeIndex([&#x27;2020-03-13 06:00:00&#x27;, &#x27;2020-03-13 07:00:00&#x27;,
               &#x27;2020-03-13 08:00:00&#x27;, &#x27;2020-03-13 09:00:00&#x27;,
               &#x27;2020-03-13 10:00:00&#x27;, &#x27;2020-03-13 11:00:00&#x27;,
               &#x27;2020-03-13 12:00:00&#x27;, &#x27;2020-03-13 13:00:00&#x27;,
               &#x27;2020-03-13 14:00:00&#x27;, &#x27;2020-03-13 15:00:00&#x27;],
              dtype=&#x27;datetime64[ns]&#x27;, name=&#x27;time&#x27;, freq=&#x27;h&#x27;))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-1c5287b2-8682-4b5c-b011-ce5009522e41' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-1c5287b2-8682-4b5c-b011-ce5009522e41' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">da_stat_ststst</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Source</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;xarray.plot.facetgrid.FacetGrid at 0x154d133db650&gt;
</pre></div>
</div>
<img alt="../_images/def9ebff698275c4b9e1984f895e9b1bbf99bf3454b4d256e530ac1336a7caf5.png" src="../_images/def9ebff698275c4b9e1984f895e9b1bbf99bf3454b4d256e530ac1336a7caf5.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">da_stat_ststst</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;Source&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="s1">&#39;Source&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;xarray.plot.facetgrid.FacetGrid at 0x154d1075f470&gt;
</pre></div>
</div>
<img alt="../_images/178c65ccc91a722f85c283f088c43ed8a4fc1308a914767fe9e9811fe08b4fa7.png" src="../_images/178c65ccc91a722f85c283f088c43ed8a4fc1308a914767fe9e9811fe08b4fa7.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xr</span><span class="o">.</span><span class="n">merge</span><span class="p">([</span><span class="n">df_col_2d</span><span class="p">[</span><span class="s1">&#39;alb&#39;</span><span class="p">],</span><span class="n">da_stat_ststst</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;time_diff&#39;</span><span class="p">)])[</span><span class="s1">&#39;alb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;x_round&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;y_round&#39;</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="s1">&#39;Source&#39;</span><span class="p">,</span><span class="n">robust</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1">#xr.merge([df_col_2d[&#39;alb&#39;]])[&#39;alb&#39;].plot(x=&#39;x_round&#39;,y=&#39;y_round&#39;,row=&#39;time&#39;,col=&#39;Source&#39;,robust=True)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## create wind speed variable</span>
<span class="n">df_col_2d</span><span class="p">[</span><span class="s1">&#39;ws&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">df_col_2d</span><span class="p">[</span><span class="s1">&#39;us&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">df_col_2d</span><span class="p">[</span><span class="s1">&#39;vs&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## remove domain mean</span>
<span class="k">for</span> <span class="n">si</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_col_2d</span><span class="p">[</span><span class="s1">&#39;Source&#39;</span><span class="p">])):</span>
    <span class="k">for</span> <span class="n">ti</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_col_2d</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])):</span>
        <span class="n">df_core</span> <span class="o">=</span> <span class="n">df_col_2d</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Source</span><span class="o">=</span><span class="n">si</span><span class="p">)</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">ti</span><span class="p">)</span><span class="o">.</span><span class="n">drop_vars</span><span class="p">([</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;Source&#39;</span><span class="p">])</span>
        <span class="n">df_core</span><span class="p">[</span><span class="s1">&#39;ws_res&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_core</span><span class="p">[</span><span class="s1">&#39;ws&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_core</span><span class="p">[</span><span class="s1">&#39;ws&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">df_core</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_col_2d</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ti</span><span class="p">]</span>
        <span class="n">df_core</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_core</span><span class="p">],</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="n">coords</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ti</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">df_sim_tcol</span> <span class="o">=</span> <span class="n">df_core</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df_sim_tcol</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_sim_tcol</span><span class="p">,</span><span class="n">df_core</span><span class="p">],</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="n">coords</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
                
    <span class="n">df_sim</span> <span class="o">=</span> <span class="n">df_sim_tcol</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">df_sim</span><span class="p">[</span><span class="s1">&#39;Source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_col_2d</span><span class="p">[</span><span class="s1">&#39;Source&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">si</span><span class="p">]</span>
    <span class="n">df_sim</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_sim</span><span class="p">],</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;Source&#39;</span><span class="p">,</span><span class="n">coords</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">si</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">df_sim_scol</span> <span class="o">=</span> <span class="n">df_sim</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">df_sim_scol</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_sim_scol</span><span class="p">,</span><span class="n">df_sim</span><span class="p">],</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;Source&#39;</span><span class="p">,</span><span class="n">coords</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
        
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Successful example of two layers</span>
<span class="n">df_sim_scol</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Source</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">4</span><span class="p">)[</span><span class="s1">&#39;ws_res&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">x_round</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mf">12.5</span><span class="p">,</span><span class="mf">12.5</span><span class="p">))</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">y_round</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mf">12.5</span><span class="p">,</span><span class="mf">12.5</span><span class="p">))</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;coolwarm&#39;</span><span class="p">)</span>
<span class="n">df_sim_scol</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Source</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">4</span><span class="p">)[</span><span class="s1">&#39;opt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">x_round</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mf">12.5</span><span class="p">,</span><span class="mf">12.5</span><span class="p">))</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">y_round</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mf">12.5</span><span class="p">,</span><span class="mf">12.5</span><span class="p">))</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">levels</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Somehow two layers won&#39;t work for faceting</span>
<span class="n">plot</span> <span class="o">=</span> <span class="n">df_sim_scol</span><span class="p">[</span><span class="s1">&#39;ws_res&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">x_round</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mf">12.5</span><span class="p">,</span><span class="mf">12.5</span><span class="p">))</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">y_round</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mf">12.5</span><span class="p">,</span><span class="mf">12.5</span><span class="p">))</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;x_round&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;y_round&#39;</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="s1">&#39;Source&#39;</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;coolwarm&#39;</span><span class="p">)</span>
<span class="n">plot</span> <span class="o">=</span> <span class="n">df_sim_scol</span><span class="p">[</span><span class="s1">&#39;opt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">x_round</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mf">12.5</span><span class="p">,</span><span class="mf">12.5</span><span class="p">))</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">y_round</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mf">12.5</span><span class="p">,</span><span class="mf">12.5</span><span class="p">))</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">levels</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span><span class="o">,</span><span class="w"> </span><span class="nn">sys</span><span class="o">,</span><span class="w"> </span><span class="nn">tarfile</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">netCDF4</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nc</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">glob</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="c1">## test to apply clustering algorithm ###</span>

<span class="c1">## certain properties</span>
<span class="n">RES_ORG</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">RES_CLA</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="c1">## use both obs and LES</span>
<span class="n">df_col_2d_tot</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">merge</span><span class="p">([</span><span class="n">df_col_2d</span><span class="p">,</span><span class="n">da_stat_ststst</span><span class="o">.</span><span class="n">drop_vars</span><span class="p">(</span><span class="s1">&#39;time_diff&#39;</span><span class="p">)])</span>

<span class="c1">## certain thresholds</span>
<span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">df_col_2d_tot</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Source</span><span class="o">=</span><span class="n">ss</span><span class="p">)[</span><span class="s1">&#39;Source&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-----&#39;</span><span class="p">)</span>
    <span class="n">tt_vec</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_col_2d_tot</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Source</span><span class="o">=</span><span class="n">ss</span><span class="p">)[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="n">tt_vec</span><span class="p">):</span>
        <span class="n">pseudo_alb</span> <span class="o">=</span> <span class="n">df_col_2d_tot</span><span class="p">[</span><span class="s1">&#39;alb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">tt</span><span class="p">)</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Source</span><span class="o">=</span><span class="n">ss</span><span class="p">)</span><span class="o">.</span><span class="n">data</span>
        <span class="n">pseudo_alb</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">pseudo_alb</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1">#if &#39;opt&#39; in df_col_2d_tot.isel(Source=ss).keys():</span>
        <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">df_col_2d_tot</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Source</span><span class="o">=</span><span class="n">ss</span><span class="p">)[</span><span class="s1">&#39;opt&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">pseudo_alb</span>  <span class="o">=</span> <span class="n">df_col_2d_tot</span><span class="p">[</span><span class="s1">&#39;alb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">tt</span><span class="p">)</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Source</span><span class="o">=</span><span class="n">ss</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">x_round</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">df_col_2d</span><span class="p">[</span><span class="s1">&#39;x_round&#39;</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">df_col_2d</span><span class="p">[</span><span class="s1">&#39;x_round&#39;</span><span class="p">])))</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">y_round</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">df_col_2d</span><span class="p">[</span><span class="s1">&#39;y_round&#39;</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">df_col_2d</span><span class="p">[</span><span class="s1">&#39;y_round&#39;</span><span class="p">])))</span><span class="o">.</span><span class="n">data</span>
            <span class="n">opd_cloud</span>  <span class="o">=</span> <span class="n">df_col_2d_tot</span><span class="p">[</span><span class="s1">&#39;opt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">tt</span><span class="p">)</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Source</span><span class="o">=</span><span class="n">ss</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">x_round</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">df_col_2d</span><span class="p">[</span><span class="s1">&#39;x_round&#39;</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">df_col_2d</span><span class="p">[</span><span class="s1">&#39;x_round&#39;</span><span class="p">])))</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">y_round</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">df_col_2d</span><span class="p">[</span><span class="s1">&#39;y_round&#39;</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">df_col_2d</span><span class="p">[</span><span class="s1">&#39;y_round&#39;</span><span class="p">])))</span><span class="o">.</span><span class="n">data</span>
            
            <span class="n">THRES_CONNECT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanquantile</span><span class="p">(</span><span class="n">pseudo_alb</span><span class="p">[(</span><span class="n">opd_cloud</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">2.0</span><span class="p">],</span><span class="mf">0.50</span><span class="p">)</span>
            <span class="n">THRES_CLOUD</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanquantile</span><span class="p">(</span><span class="n">pseudo_alb</span><span class="p">[(</span><span class="n">opd_cloud</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">2.0</span><span class="p">],</span><span class="mf">0.50</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;here!&#39;</span><span class="p">)</span>
            <span class="n">THRES_CONNECT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanquantile</span><span class="p">(</span><span class="n">pseudo_alb</span><span class="p">,</span><span class="mf">0.50</span><span class="p">)</span>
            <span class="n">THRES_CLOUD</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanquantile</span><span class="p">(</span><span class="n">pseudo_alb</span><span class="p">,</span><span class="mf">0.50</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">THRES_CONNECT</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">THRES_CLOUD</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">pseudo_alb</span> <span class="o">&gt;</span> <span class="n">THRES_CLOUD</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">CLUST_COORDS</span> <span class="o">=</span> <span class="n">id_watershed</span><span class="p">(</span><span class="n">pseudo_alb</span><span class="p">,</span><span class="n">THRES_CLOUD</span><span class="p">,</span><span class="n">THRES_CONNECT</span><span class="p">,</span><span class="n">plotting</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">CLUST_GEOM</span> <span class="o">=</span> <span class="n">cluster_geometry</span><span class="p">(</span><span class="n">CLUST_COORDS</span><span class="p">,</span><span class="n">total</span><span class="o">=</span><span class="p">[(</span><span class="n">shape</span><span class="p">(</span><span class="n">pseudo_alb</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">shape</span><span class="p">(</span><span class="n">pseudo_alb</span><span class="p">)[</span><span class="mi">1</span><span class="p">])])</span>
            <span class="n">CLUST_GEOM</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">df_col_2d_tot</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">tt</span><span class="p">)</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Source</span><span class="o">=</span><span class="n">ss</span><span class="p">)[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
            <span class="n">CLUST_GEOM</span><span class="p">[</span><span class="s1">&#39;Source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_col_2d_tot</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">tt</span><span class="p">)</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Source</span><span class="o">=</span><span class="n">ss</span><span class="p">)[</span><span class="s1">&#39;Source&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">CLUST_GEOM</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">counter</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">CLUST_GEOM_COL</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">CLUST_GEOM</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">CLUST_GEOM_COL</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">CLUST_GEOM_COL</span><span class="p">,</span><span class="n">CLUST_GEOM</span><span class="p">])</span>
            <span class="n">counter</span> <span class="o">+=</span><span class="mi">1</span>
    
<span class="c1">## coarsen field</span>
<span class="c1">#var_coarse = coarsen_2d(pseudo_alb,RES_CLA=RES_CLA,RES_ORG=RES_ORG)</span>
<span class="c1">#nx_coa = var_coarse.shape[0]</span>


<span class="c1">#plt.imshow(df_col_2d[&#39;alb&#39;].isel(time=3).isel(Source=1).data)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">CLUST_GEOM_COL</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cluster_geometry</span><span class="p">(</span><span class="n">CLUST_COORDS</span><span class="p">,</span><span class="n">total</span><span class="o">=</span><span class="p">[(</span><span class="n">shape</span><span class="p">(</span><span class="n">pseudo_alb</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">shape</span><span class="p">(</span><span class="n">pseudo_alb</span><span class="p">)[</span><span class="mi">1</span><span class="p">])])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">CLUST_GEOM_COL</span><span class="p">[</span><span class="s1">&#39;time_conv&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">CLUST_GEOM_COL</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;2020-03-12 22:00:00&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;timedelta64[h]&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#p#lt.hist(CLUST_GEOM_COL[&#39;area&#39;],label=CLUST_GEOM_COL[&#39;Source&#39;])</span>

<span class="n">CLUST_GEOM_COL</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Source&#39;</span><span class="p">)[</span><span class="s1">&#39;area&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">CLUST_STAT_1</span> <span class="o">=</span> <span class="n">CLUST_GEOM_COL</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Source&#39;</span><span class="p">,</span><span class="s1">&#39;time_conv&#39;</span><span class="p">])[</span><span class="s1">&#39;area&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
<span class="n">CLUST_STAT_2</span> <span class="o">=</span> <span class="n">CLUST_GEOM_COL</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Source&#39;</span><span class="p">,</span><span class="s1">&#39;time_conv&#39;</span><span class="p">])[</span><span class="s1">&#39;area&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">CLUST_STAT_1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">name</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="n">CLUST_STAT_1</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Source&#39;</span><span class="p">):</span>
    <span class="n">j</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Number of Cells&#39;</span><span class="p">,</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Time since 2020-03-12 22:00 (hours)&#39;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Number of Cells&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">name</span><span class="p">,</span><span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">name</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="n">CLUST_STAT_2</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Source&#39;</span><span class="p">):</span>
    <span class="n">j</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Maximum Cell Size&#39;</span><span class="p">,</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Time since 2020-03-12 22:00 (hours)&#39;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Cell Size&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">name</span><span class="p">,</span><span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">CLUST_GEOM_COL</span><span class="p">[</span><span class="s1">&#39;Clust&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CLUST_GEOM_COL</span><span class="o">.</span><span class="n">index</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="o">.</span><span class="n">flat</span><span class="p">,</span> <span class="n">CLUST_GEOM_COL</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Source&#39;</span><span class="p">,</span><span class="s1">&#39;time_conv&#39;</span><span class="p">])):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span>
    <span class="n">time</span> <span class="o">=</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;area&#39;</span><span class="p">],</span><span class="n">labels</span><span class="o">=</span><span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">autopct</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.1f</span><span class="s1">&#39;</span><span class="p">,)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">time</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
<span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">CLUST_GEOM_COL</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Source&#39;</span><span class="p">]):</span>
    <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;time&#39;</span><span class="p">]):</span>
        <span class="c1">#print(f)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Clust&#39;</span><span class="p">)[</span><span class="s1">&#39;area&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="nb">next</span><span class="p">(</span><span class="n">ax</span><span class="p">),</span>  <span class="n">autopct</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.1f</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
<span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">CLUST_GEOM_COL</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Source&#39;</span><span class="p">]):</span>
    <span class="n">g</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Clust&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)[</span><span class="s1">&#39;area&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="nb">next</span><span class="p">(</span><span class="n">ax</span><span class="p">),</span>  <span class="n">autopct</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.1f</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">CLUST_COORDS_BIG</span> <span class="o">=</span> <span class="n">CLUST_COORDS</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>


<span class="n">CLUST_COORDS_BIG</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">CLUST_COORDS</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">RES_CLA</span><span class="o">/</span><span class="n">RES_ORG</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">RES_CLA</span><span class="o">/</span><span class="n">RES_ORG</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
<span class="n">CLUST_COORDS_BIG</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">CLUST_COORDS</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">RES_CLA</span><span class="o">/</span><span class="n">RES_ORG</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">RES_CLA</span><span class="o">/</span><span class="n">RES_ORG</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>

    
<span class="n">CLUST_GEOM</span> <span class="o">=</span> <span class="n">cluster_geometry</span><span class="p">(</span><span class="n">CLUST_COORDS_BIG</span><span class="p">,</span><span class="n">total</span><span class="o">=</span><span class="p">[(</span><span class="n">shape</span><span class="p">(</span><span class="n">pseudo_alb</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">shape</span><span class="p">(</span><span class="n">pseudo_alb</span><span class="p">)[</span><span class="mi">1</span><span class="p">])])</span>
<span class="n">CLUST_GEOM</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">CLUST_GEOM</span><span class="p">,</span><span class="n">CLUST_GEOM</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">CLUST_GEOM</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">CLUST_GEOM</span><span class="o">.</span><span class="n">area</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## select simulations to plot</span>
<span class="n">sim_keyword</span> <span class="o">=</span> <span class="s1">&#39;DHARMA_Lx25_dx100_FixN_2D&#39;</span> <span class="c1">#UCLALES-SALSA_Lx25_dx100_FixN_2D&#39;  </span>

<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s2">&quot;/user-data-home/comble-mip/notebooks/plotting/&quot;</span><span class="p">)</span>
<span class="o">%</span><span class="k">run</span> functions_plotting.py 

<span class="c1">## load all simulations located in subfolders of the given directory</span>
<span class="n">df_col_2d</span> <span class="o">=</span> <span class="n">load_sims_2d</span><span class="p">(</span><span class="s1">&#39;/data/project/comble-mip/output_les/&#39;</span><span class="p">,</span><span class="n">var_vec_2d</span><span class="p">,</span><span class="n">t_shift</span><span class="o">=-</span><span class="mi">2</span><span class="p">,</span><span class="n">keyword</span><span class="o">=</span><span class="n">sim_keyword</span><span class="p">,</span><span class="n">times</span><span class="o">=</span><span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">Time_Vec</span> <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">],</span><span class="n">coarsen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">var_vec_2d</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;olr11&#39;</span><span class="p">]</span>

<span class="n">df_col_2d</span><span class="p">[</span><span class="s1">&#39;olr11&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="n">col_wrap</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="s1">&#39;Source&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_col_2d</span><span class="p">[</span><span class="s1">&#39;olr11&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "conda-base-py"
        },
        kernelOptions: {
            name: "conda-base-py",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'conda-base-py'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By GISS Cloud Group
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
       Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>